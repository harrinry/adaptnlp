---

title: Squad Evaluate Utilities


keywords: fastai
sidebar: home_sidebar

summary: "Utility functions for Squad Results"
description: "Utility functions for Squad Results"
nb_path: "nbs/13c_transformers.utils_squad_evaluate.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/13c_transformers.utils_squad_evaluate.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="EVAL_OPTS" class="doc_header"><code>class</code> <code>EVAL_OPTS</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L28" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>EVAL_OPTS</code>(<strong><code>data_file</code></strong>, <strong><code>pred_file</code></strong>, <strong><code>out_file</code></strong>=<em><code>''</code></em>, <strong><code>na_prob_file</code></strong>=<em><code>'na_prob.json'</code></em>, <strong><code>na_prob_thresh</code></strong>=<em><code>1.0</code></em>, <strong><code>out_image_dir</code></strong>=<em><code>None</code></em>, <strong><code>verbose</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_args" class="doc_header"><code>parse_args</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L51" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_args</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="make_qid_to_has_ans" class="doc_header"><code>make_qid_to_has_ans</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L90" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>make_qid_to_has_ans</code>(<strong><code>dataset</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="normalize_answer" class="doc_header"><code>normalize_answer</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L99" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>normalize_answer</code>(<strong><code>s</code></strong>)</p>
</blockquote>
<p>Lower text and remove punctuation, articles and extra whitespace.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_tokens" class="doc_header"><code>get_tokens</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L119" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_tokens</code>(<strong><code>s</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compute_exact" class="doc_header"><code>compute_exact</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L125" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compute_exact</code>(<strong><code>a_gold</code></strong>, <strong><code>a_pred</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compute_f1" class="doc_header"><code>compute_f1</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L129" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compute_f1</code>(<strong><code>a_gold</code></strong>, <strong><code>a_pred</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_raw_scores" class="doc_header"><code>get_raw_scores</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L145" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_raw_scores</code>(<strong><code>dataset</code></strong>, <strong><code>preds</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="apply_no_ans_threshold" class="doc_header"><code>apply_no_ans_threshold</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L168" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>apply_no_ans_threshold</code>(<strong><code>scores</code></strong>, <strong><code>na_probs</code></strong>, <strong><code>qid_to_has_ans</code></strong>, <strong><code>na_prob_thresh</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="make_eval_dict" class="doc_header"><code>make_eval_dict</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L179" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>make_eval_dict</code>(<strong><code>exact_scores</code></strong>, <strong><code>f1_scores</code></strong>, <strong><code>qid_list</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="merge_eval" class="doc_header"><code>merge_eval</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L200" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>merge_eval</code>(<strong><code>main_eval</code></strong>, <strong><code>new_eval</code></strong>, <strong><code>prefix</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_pr_curve" class="doc_header"><code>plot_pr_curve</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L205" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_pr_curve</code>(<strong><code>precisions</code></strong>, <strong><code>recalls</code></strong>, <strong><code>out_image</code></strong>, <strong><code>title</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="make_precision_recall_eval" class="doc_header"><code>make_precision_recall_eval</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L217" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>make_precision_recall_eval</code>(<strong><code>scores</code></strong>, <strong><code>na_probs</code></strong>, <strong><code>num_true_pos</code></strong>, <strong><code>qid_to_has_ans</code></strong>, <strong><code>out_image</code></strong>=<em><code>None</code></em>, <strong><code>title</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="run_precision_recall_analysis" class="doc_header"><code>run_precision_recall_analysis</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L242" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>run_precision_recall_analysis</code>(<strong><code>main_eval</code></strong>, <strong><code>exact_raw</code></strong>, <strong><code>f1_raw</code></strong>, <strong><code>na_probs</code></strong>, <strong><code>qid_to_has_ans</code></strong>, <strong><code>out_image_dir</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="histogram_na_prob" class="doc_header"><code>histogram_na_prob</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L280" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>histogram_na_prob</code>(<strong><code>na_probs</code></strong>, <strong><code>qid_list</code></strong>, <strong><code>image_dir</code></strong>, <strong><code>name</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="find_best_thresh" class="doc_header"><code>find_best_thresh</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L293" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>find_best_thresh</code>(<strong><code>preds</code></strong>, <strong><code>scores</code></strong>, <strong><code>na_probs</code></strong>, <strong><code>qid_to_has_ans</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="find_best_thresh_v2" class="doc_header"><code>find_best_thresh_v2</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L316" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>find_best_thresh_v2</code>(<strong><code>preds</code></strong>, <strong><code>scores</code></strong>, <strong><code>na_probs</code></strong>, <strong><code>qid_to_has_ans</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="find_all_best_thresh" class="doc_header"><code>find_all_best_thresh</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L354" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>find_all_best_thresh</code>(<strong><code>main_eval</code></strong>, <strong><code>preds</code></strong>, <strong><code>exact_raw</code></strong>, <strong><code>f1_raw</code></strong>, <strong><code>na_probs</code></strong>, <strong><code>qid_to_has_ans</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="find_all_best_thresh_v2" class="doc_header"><code>find_all_best_thresh_v2</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L365" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>find_all_best_thresh_v2</code>(<strong><code>main_eval</code></strong>, <strong><code>preds</code></strong>, <strong><code>exact_raw</code></strong>, <strong><code>f1_raw</code></strong>, <strong><code>na_probs</code></strong>, <strong><code>qid_to_has_ans</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="main" class="doc_header"><code>main</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/transformers/utils_squad_evaluate.py#L382" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>main</code>(<strong><code>OPTS</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

