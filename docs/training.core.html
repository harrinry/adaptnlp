---

title: Training Foundations


keywords: fastai
sidebar: home_sidebar

summary: "Basic classes and helpers for modularized training"
description: "Basic classes and helpers for modularized training"
nb_path: "nbs/12_training.core.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/12_training.core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ParentLabeller" class="doc_header"><code>class</code> <code>ParentLabeller</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L40" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ParentLabeller</code>(<strong><code>level</code></strong>=<em><code>1</code></em>)</p>
</blockquote>
<p>Extracts class based on filename's parent at <code>level</code></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>level</code></strong> : <em><code>&lt;class 'int'&gt;</code></em>, <em>optional</em>  <p>The level up from `fname` to find the label</p></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ColReader" class="doc_header"><code>class</code> <code>ColReader</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L59" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ColReader</code>(<strong><code>cols</code></strong>, <strong><code>pref</code></strong>:<code>str</code>=<em><code>''</code></em>, <strong><code>suff</code></strong>:<code>str</code>=<em><code>''</code></em>, <strong><code>label_delim</code></strong>:<code>str</code>=<em><code>None</code></em>)</p>
</blockquote>
<p>Reads <code>cols</code> in <code>row</code> with potential <code>pref</code> and <code>suff</code>
Based on the fastai class</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>cols</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em>    <p>Some column names to use</p></li>
</ul>
<ul>
<li><strong><code>pref</code></strong> : <em><code>&lt;class 'str'&gt;</code></em>, <em>optional</em>   <p>A prefix</p></li>
</ul>
<ul>
<li><strong><code>suff</code></strong> : <em><code>&lt;class 'str'&gt;</code></em>, <em>optional</em>   <p>A suffix</p></li>
</ul>
<ul>
<li><strong><code>label_delim</code></strong> : <em><code>&lt;class 'str'&gt;</code></em>, <em>optional</em>    <p>A label delimiter</p></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Categorize" class="doc_header"><code>class</code> <code>Categorize</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L86" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Categorize</code>(<strong><code>names</code></strong>, <strong><code>sort</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Collection of categories with reverse mapping in <code>o2i</code>
Based on the fastai class</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>names</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em>   <p>An interable collection of items to create a vocab from</p></li>
</ul>
<ul>
<li><strong><code>sort</code></strong> : <em><code>&lt;class 'bool'&gt;</code></em>, <em>optional</em>  <p>Whether to make the items sorted</p></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Categorize.map_objs" class="doc_header"><code>Categorize.map_objs</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L101" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Categorize.map_objs</code>(<strong><code>objs</code></strong>)</p>
</blockquote>
<p>Map <code>objs</code> to IDs</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>objs</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em>    <p>Some iterable collection</p></li>
</ul>
<p><strong>Returns</strong>:</p>
<ul>
<li><em><code>&lt;class 'fastcore.foundation.L'&gt;</code></em></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Categorize.map_ids" class="doc_header"><code>Categorize.map_ids</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L108" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Categorize.map_ids</code>(<strong><code>ids</code></strong>)</p>
</blockquote>
<p>Map <code>ids</code> to objects in vocab</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>ids</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em> <p>Some ids correlating to `self.classes`</p></li>
</ul>
<p><strong>Returns</strong>:</p>
<ul>
<li><em><code>&lt;class 'fastcore.foundation.L'&gt;</code></em></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="Categorize.decode" class="doc_header"><code>Categorize.decode</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L119" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>Categorize.decode</code>(<strong><code>o</code></strong>)</p>
</blockquote>
<p>Decodes <code>o</code> by looking in <code>self.classes</code></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>o</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em>   <p>A key in self.classes</p></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MultiCategorize" class="doc_header"><code>class</code> <code>MultiCategorize</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L127" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MultiCategorize</code>(<strong><code>names</code></strong>) :: <a href="/adaptnlp/training.core.html#Categorize"><code>Categorize</code></a></p>
</blockquote>
<p>Collection of multi-categories with reverse mapping in <code>o2i</code>
Based on the fastai class</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>names</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em>   <p>An interable collection of items to create a vocab from</p></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="MultiCategorize.decode" class="doc_header"><code>MultiCategorize.decode</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L147" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>MultiCategorize.decode</code>(<strong><code>o</code></strong>)</p>
</blockquote>
<p>Decodes <code>o</code> by looking in <code>self.classes</code></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>o</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em>   <p>A list of keys in self.classes</p></li>
</ul>
<p><strong>Returns</strong>:</p>
<ul>
<li><em><code>&lt;class 'list'&gt;</code></em></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Splitters">Splitters<a class="anchor-link" href="#Splitters"> </a></h2><p>Functions designed for splitting your data</p>
<p>To write your own you should make a function that returns two <code>L</code>'s of indicies (or <code>lists</code> work as well)</p>
<p>For example, if I have a dataset of 5 items, we start with <code>[0,1,2,3,4]</code>. If I wanted to write a split function to split the first three and last two items into train and validation, I can write it as:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">split_func</span><span class="p">(</span><span class="n">idxs</span><span class="p">):</span> <span class="k">return</span> <span class="n">L</span><span class="p">(</span><span class="n">idxs</span><span class="p">[:</span><span class="mi">3</span><span class="p">]),</span> <span class="n">L</span><span class="p">(</span><span class="n">idxs</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And we can see it work:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">split_func</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((#3) [0,1,2], (#2) [3,4])</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="RandomSplitter" class="doc_header"><code>RandomSplitter</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L155" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>RandomSplitter</code>(<strong><code>valid_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>seed</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Creates a function that splits some items between train and validation with <code>valid_pct</code> randomly
Based on the fastai class</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><p><strong><code>valid_pct</code></strong> : <em><code>&lt;class 'float'&gt;</code></em>, <em>optional</em></p>
</li>
<li><p><strong><code>seed</code></strong> : <em><code>&lt;class 'NoneType'&gt;</code></em>, <em>optional</em></p>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TaskDatasets" class="doc_header"><code>class</code> <code>TaskDatasets</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L171" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TaskDatasets</code>(<strong><code>train_dset</code></strong>, <strong><code>valid_dset</code></strong>, <strong><code>tokenizer_name</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong><code>tokenize</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>tokenize_func</code></strong>:<code>callable</code>=<em><code>None</code></em>, <strong><code>tokenize_kwargs</code></strong>:<code>dict</code>=<em><code>{}</code></em>, <strong><code>auto_kwargs</code></strong>:<code>dict</code>=<em><code>{}</code></em>, <strong><code>remove_cols</code></strong>:<code>Union</code>[<code>str</code>, <code>List</code>[<code>str</code>]]=<em><code>None</code></em>, <strong><code>label_keys</code></strong>:<code>list</code>=<em><code>['labels']</code></em>)</p>
</blockquote>
<p>A set of datasets for a particular task, with a simple API.</p>
<p>Note: This is the base API, <code>items</code> should be a set of regular text and model-ready labels,
      including label or one-hot encoding being applied.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>train_dset</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em>  <p>A train `Dataset` object</p></li>
</ul>
<ul>
<li><strong><code>valid_dset</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em>  <p>A validation `Dataset` object</p></li>
</ul>
<ul>
<li><strong><code>tokenizer_name</code></strong> : <em><code>&lt;class 'str'&gt;</code></em>, <em>optional</em> <p>The string name of a `HuggingFace` tokenizer or model. If `None`, will not tokenize the dataset.</p></li>
</ul>
<ul>
<li><strong><code>tokenize</code></strong> : <em><code>&lt;class 'bool'&gt;</code></em>, <em>optional</em>  <p>Whether to tokenize the dataset immediatly</p></li>
</ul>
<ul>
<li><strong><code>tokenize_func</code></strong> : <em><code>&lt;built-in function callable&gt;</code></em>, <em>optional</em>   <p>A function to tokenize an item with</p></li>
</ul>
<ul>
<li><strong><code>tokenize_kwargs</code></strong> : <em><code>&lt;class 'dict'&gt;</code></em>, <em>optional</em>   <p>Some kwargs for when we call the tokenizer</p></li>
</ul>
<ul>
<li><strong><code>auto_kwargs</code></strong> : <em><code>&lt;class 'dict'&gt;</code></em>, <em>optional</em>   <p>Some kwargs when calling `AutoTokenizer.from_pretrained`</p></li>
</ul>
<ul>
<li><strong><code>remove_cols</code></strong> : <em><code>typing.Union[str, typing.List[str]]</code></em>, <em>optional</em>  <p>What columns to remove</p></li>
</ul>
<ul>
<li><strong><code>label_keys</code></strong> : <em><code>&lt;class 'list'&gt;</code></em>, <em>optional</em>    <p>The keys in each item that relate to the label (such as `labels`)</p></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="TaskDatasets.set_tokenizer" class="doc_header"><code>TaskDatasets.set_tokenizer</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L222" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>TaskDatasets.set_tokenizer</code>(<strong><code>tokenizer_name</code></strong>:<code>str</code>, <strong><code>override_existing</code></strong>:<code>bool</code>=<em><code>False</code></em>)</p>
</blockquote>
<p>Sets a new <code>AutoTokenizer</code> to <code>self.tokenizer</code></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>tokenizer_name</code></strong> : <em><code>&lt;class 'str'&gt;</code></em> <p>A string name of a `HuggingFace` tokenizer or model</p></li>
</ul>
<ul>
<li><strong><code>override_existing</code></strong> : <em><code>&lt;class 'bool'&gt;</code></em>, <em>optional</em> <p>Whether to override an existing tokenizer</p></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="TaskDatasets.dataloaders" class="doc_header"><code>TaskDatasets.dataloaders</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L252" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>TaskDatasets.dataloaders</code>(<strong><code>batch_size</code></strong>:<code>int</code>=<em><code>8</code></em>, <strong><code>shuffle_train</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>collate_fn</code></strong>:<code>callable</code>=<em><code>None</code></em>, <strong><code>path</code></strong>=<em><code>'.'</code></em>, <strong><code>device</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Creates <code>DataLoaders</code> from the dataset</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>batch_size</code></strong> : <em><code>&lt;class 'int'&gt;</code></em>, <em>optional</em> <p>A batch size</p></li>
</ul>
<ul>
<li><strong><code>shuffle_train</code></strong> : <em><code>&lt;class 'bool'&gt;</code></em>, <em>optional</em> <p>Whether to shuffle the training dataset</p></li>
</ul>
<ul>
<li><strong><code>collate_fn</code></strong> : <em><code>&lt;built-in function callable&gt;</code></em>, <em>optional</em>  <p>A custom collation function</p></li>
</ul>
<ul>
<li><p><strong><code>path</code></strong> : <em><code>&lt;class 'str'&gt;</code></em>, <em>optional</em></p>
</li>
<li><p><strong><code>device</code></strong> : <em><code>&lt;class 'NoneType'&gt;</code></em>, <em>optional</em></p>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="AdaptiveDataLoaders" class="doc_header"><code>class</code> <code>AdaptiveDataLoaders</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L267" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>AdaptiveDataLoaders</code>(<strong>*<code>loaders</code></strong>, <strong><code>tokenizer</code></strong>=<em><code>None</code></em>, <strong><code>label_keys</code></strong>:<code>list</code>=<em><code>['labels']</code></em>, <strong><code>path</code></strong>=<em><code>'.'</code></em>, <strong><code>device</code></strong>=<em><code>None</code></em>) :: <code>DataLoaders</code></p>
</blockquote>
<p>A set of <code>DataLoaders</code> that keeps track of a <code>tokenizer</code></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><p><strong><code>loaders</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></p>
</li>
<li><p><strong><code>tokenizer</code></strong> : <em><code>&lt;class 'NoneType'&gt;</code></em>, <em>optional</em></p>
</li>
<li><p><strong><code>label_keys</code></strong> : <em><code>&lt;class 'list'&gt;</code></em>, <em>optional</em></p>
</li>
<li><p><strong><code>path</code></strong> : <em><code>&lt;class 'str'&gt;</code></em>, <em>optional</em></p>
</li>
<li><p><strong><code>device</code></strong> : <em><code>&lt;class 'NoneType'&gt;</code></em>, <em>optional</em></p>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="AdaptiveDataLoaders.show_batch" class="doc_header"><code>AdaptiveDataLoaders.show_batch</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L281" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>AdaptiveDataLoaders.show_batch</code>(<strong><code>ds_idx</code></strong>:<code>int</code>=<em><code>0</code></em>, <strong><code>n</code></strong>:<code>int</code>=<em><code>5</code></em>, <strong><code>raw</code></strong>:<code>bool</code>=<em><code>False</code></em>)</p>
</blockquote>
<p>Show a batch of data</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastcore.basics</span> <span class="kn">import</span> <span class="n">mk_class</span>
<span class="kn">from</span> <span class="nn">nbverbose.showdoc</span> <span class="kn">import</span> <span class="n">show_doc</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h3 id="Strategy" class="doc_header"><code>class</code> <code>Strategy</code><a href="" class="source_link" style="float:right">[source]</a></h3><blockquote><p><code>Strategy</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Class for fitting strategies with typo-proofing</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><p><strong><code>args</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></p>
</li>
<li><p><strong><code>kwargs</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></p>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Supported strategies:
* CosineAnnealing
* OneCycle
* SGDR
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="AdaptiveTuner" class="doc_header"><code>class</code> <code>AdaptiveTuner</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L376" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>AdaptiveTuner</code>(<strong><code>expose_fastai</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>tokenizer</code></strong>=<em><code>None</code></em>, <strong><code>label_keys</code></strong>:<code>list</code>=<em><code>['labels']</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>A base <code>Tuner</code> that interfaces with <code>AdaptiveLearner</code> with specific exposed functions</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>expose_fastai</code></strong> : <em><code>&lt;class 'bool'&gt;</code></em>, <em>optional</em> <p>Whether to expose the entire API in `self`</p></li>
</ul>
<ul>
<li><strong><code>tokenizer</code></strong> : <em><code>&lt;class 'NoneType'&gt;</code></em>, <em>optional</em> <p>A HuggingFace tokenizer</p></li>
</ul>
<ul>
<li><strong><code>label_keys</code></strong> : <em><code>&lt;class 'list'&gt;</code></em>, <em>optional</em>    <p>A list of keys correlating to the labels in the batch</p></li>
</ul>
<ul>
<li><strong><code>kwargs</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since <code>fastai</code> is a <em>very</em> lightweight framework that is easily approachable and incorporates state-of-the-art ideas, <code>AdaptNLP</code> bridges the gap between HuggingFace and fastai, allowing you to train with their framework through the <code>*Tuner</code> classes</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The constructor of the <a href="/adaptnlp/training.core.html#AdaptiveTuner"><code>AdaptiveTuner</code></a> class has an optional <code>expose_fastai_api</code> parameter. When set to <code>True</code>, the <code>Tuner</code> inherits fastai's <code>Learner</code>, so every attribute of the <code>Learner</code> is available to you. This is only recommended for those very familiar with the fastai API.</p>
<p>Otherwise, you have access to eight functions in each class:</p>
<ul>
<li><code>tune</code></li>
<li><code>lr_find</code></li>
<li><code>predict</code></li>
<li><code>save</code></li>
<li><code>load</code></li>
<li><code>export</code></li>
</ul>
<p>All task fine-tuners should inherit the <a href="/adaptnlp/training.core.html#AdaptiveTuner"><code>AdaptiveTuner</code></a>, write good defaults, and override any specific needs as dictated by the task</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="AdaptiveTuner.tune" class="doc_header"><code>AdaptiveTuner.tune</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L401" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>AdaptiveTuner.tune</code>(<strong><code>epochs</code></strong>:<code>int</code>, <strong><code>lr</code></strong>:<code>float</code>=<em><code>None</code></em>, <strong><code>strategy</code></strong>:<code>Strategy</code>=<em><code>'fit_one_cycle'</code></em>, <strong><code>callbacks</code></strong>:<code>list</code>=<em><code>[]</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Fine tune <code>self.model</code> for <code>epochs</code> with an <code>lr</code> and <code>strategy</code></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>epochs</code></strong> : <em><code>&lt;class 'int'&gt;</code></em> <p>Number of iterations to train for</p></li>
</ul>
<ul>
<li><strong><code>lr</code></strong> : <em><code>&lt;class 'float'&gt;</code></em>, <em>optional</em>   <p>If None, finds a new learning rate and uses suggestion_method</p></li>
</ul>
<ul>
<li><strong><code>strategy</code></strong> : <em><code>&lt;class 'fastcore.basics.Strategy'&gt;</code></em>, <em>optional</em>  <p>A fitting method</p></li>
</ul>
<ul>
<li><strong><code>callbacks</code></strong> : <em><code>&lt;class 'list'&gt;</code></em>, <em>optional</em> <p>Extra fastai Callbacks</p></li>
</ul>
<ul>
<li><strong><code>kwargs</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="AdaptiveTuner.lr_find" class="doc_header"><code>AdaptiveTuner.lr_find</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L415" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>AdaptiveTuner.lr_find</code>(<strong><code>start_lr</code></strong>=<em><code>1e-07</code></em>, <strong><code>end_lr</code></strong>=<em><code>10</code></em>, <strong><code>num_it</code></strong>=<em><code>100</code></em>, <strong><code>stop_div</code></strong>=<em><code>True</code></em>, <strong><code>show_plot</code></strong>=<em><code>True</code></em>, <strong><code>suggest_funcs</code></strong>=<em><code>valley</code></em>)</p>
</blockquote>
<p>Runs fastai's <code>LR Finder</code></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><p><strong><code>start_lr</code></strong> : <em><code>&lt;class 'float'&gt;</code></em>, <em>optional</em></p>
</li>
<li><p><strong><code>end_lr</code></strong> : <em><code>&lt;class 'int'&gt;</code></em>, <em>optional</em></p>
</li>
<li><p><strong><code>num_it</code></strong> : <em><code>&lt;class 'int'&gt;</code></em>, <em>optional</em></p>
</li>
<li><p><strong><code>stop_div</code></strong> : <em><code>&lt;class 'bool'&gt;</code></em>, <em>optional</em></p>
</li>
<li><p><strong><code>show_plot</code></strong> : <em><code>&lt;class 'bool'&gt;</code></em>, <em>optional</em></p>
</li>
<li><p><strong><code>suggest_funcs</code></strong> : <em><code>&lt;class 'function'&gt;</code></em>, <em>optional</em></p>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="AdaptiveTuner.save" class="doc_header"><code>AdaptiveTuner.save</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L423" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>AdaptiveTuner.save</code>(<strong><code>save_directory</code></strong>)</p>
</blockquote>
<p>Save a pretrained model to a <code>save_directory</code></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>save_directory</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em>  <p>A folder to save our model to</p></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="AdaptiveTuner.load" class="doc_header"><code>AdaptiveTuner.load</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L433" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>AdaptiveTuner.load</code>(<strong><code>path</code></strong>:<code>Union</code>[<code>Path</code>, <code>str</code>], <strong><code>device</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Loads a pretrained model with <code>AutoModel.from_pretrained</code> from <code>path</code> and loads it to device</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>path</code></strong> : <em><code>typing.Union[pathlib.Path, str]</code></em> <p>A location to load a tokenizer and weights from</p></li>
</ul>
<ul>
<li><strong><code>device</code></strong> : <em><code>&lt;class 'NoneType'&gt;</code></em>, <em>optional</em>    <p>A valid device such as `cpu` or `cuda:0`</p></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="AdaptiveTuner.predict" class="doc_header"><code>AdaptiveTuner.predict</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L445" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>AdaptiveTuner.predict</code>(<strong><code>text</code></strong>:<code>Union</code>[<code>List</code>[<code>str</code>], <code>str</code>])</p>
</blockquote>
<p>Predict some <code>text</code> with the current model. Needs to be implemented for each task separately</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>text</code></strong> : <em><code>typing.Union[typing.List[str], str]</code></em> <p>Some text or list of texts to inference with</p></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="AdaptiveTuner.export" class="doc_header"><code>AdaptiveTuner.export</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L452" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>AdaptiveTuner.export</code>(<strong><code>save_directory</code></strong>:<code>Union</code>[<code>Path</code>, <code>str</code>])</p>
</blockquote>
<p>Exports the current model and tokenizer information to <code>save_directory</code></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>save_directory</code></strong> : <em><code>typing.Union[pathlib.Path, str]</code></em>   <p>A folder to export our model to</p></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

