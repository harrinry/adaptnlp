---

title: Tutorial&#58; Fine-Tuning Sequence Classification on Text Files with IMDB


keywords: fastai
sidebar: home_sidebar

summary: "Tuning a Sequence Classification model on the IMDB Dataset"
description: "Tuning a Sequence Classification model on the IMDB Dataset"
nb_path: "nbs/training_api_tutorials/sequence_classification/sequence_classification_from_folder.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/training_api_tutorials/sequence_classification/sequence_classification_from_folder.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Introduction">Introduction<a class="anchor-link" href="#Introduction"> </a></h2><p>In this tutorial we will be showing an end-to-end example of fine-tuning a Transformer for sequence classification on a custom dataset in text files format.</p>
<p>By the end of this you should be able to:</p>
<ol>
<li>Build a dataset with the <a href="/adaptnlp/training.sequence_classification.html#SequenceClassificationDatasets"><code>SequenceClassificationDatasets</code></a> class, and their DataLoaders</li>
<li>Build a <a href="/adaptnlp/training.sequence_classification.html#SequenceClassificationTuner"><code>SequenceClassificationTuner</code></a> quickly, find a good learning rate, and train with the One-Cycle Policy</li>
<li>Save that model away, to be used with deployment or other HuggingFace libraries</li>
<li>Apply inference using both the <code>Tuner</code> available function as well as with the <a href="/adaptnlp/sequence_classification.html#EasySequenceClassifier"><code>EasySequenceClassifier</code></a> class within AdaptNLP</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Installing-the-Library">Installing the Library<a class="anchor-link" href="#Installing-the-Library"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This tutorial utilizies the latest AdaptNLP version, as well as parts of the <code>fastai</code> library. Please run the below code to install them:</p>
<div class="highlight"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">adaptnlp</span> <span class="o">-</span><span class="n">U</span>
</pre></div>
<p>(or <code>pip3</code>)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Getting-the-Dataset">Getting the Dataset<a class="anchor-link" href="#Getting-the-Dataset"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First we need a dataset. We will use the <code>fastai</code> library to download the full <code>IMDB</code> Movie Reviews dataset</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastai.data.external</span> <span class="kn">import</span> <span class="n">URLs</span><span class="p">,</span> <span class="n">untar_data</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>URLs</code> holds a namespace of many data endpoints, and <code>untar_data</code> is a function that can download and extract any data from a given URL.</p>
<p>Combining both, we can download the data:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data_path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">IMDB</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If we look at what was downloaded, we will find a <code>train</code> and <code>test</code> folder:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data_path</span><span class="o">.</span><span class="n">ls</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#7) [Path(&#39;/root/.fastai/data/imdb/test&#39;),Path(&#39;/root/.fastai/data/imdb/README&#39;),Path(&#39;/root/.fastai/data/imdb/train&#39;),Path(&#39;/root/.fastai/data/imdb/imdb.vocab&#39;),Path(&#39;/root/.fastai/data/imdb/tmp_clas&#39;),Path(&#39;/root/.fastai/data/imdb/unsup&#39;),Path(&#39;/root/.fastai/data/imdb/tmp_lm&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In each are folders seperating each text file by class:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">data_path</span><span class="o">/</span><span class="s1">&#39;train&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ls</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#4) [Path(&#39;/root/.fastai/data/imdb/train/pos&#39;),Path(&#39;/root/.fastai/data/imdb/train/neg&#39;),Path(&#39;/root/.fastai/data/imdb/train/unsupBow.feat&#39;),Path(&#39;/root/.fastai/data/imdb/train/labeledBow.feat&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As a result, we can say the dataset follows the following format:</p>
<ul>
<li><code>train</code><ul>
<li><code>class_a</code><ul>
<li><code>text1.txt</code></li>
<li><code>text2.txt</code></li>
<li>...</li>
</ul>
</li>
<li><code>class_b</code><ul>
<li><code>text1.txt</code></li>
<li>...</li>
</ul>
</li>
</ul>
</li>
<li><code>test</code> (or <code>valid</code>)<ul>
<li><code>class_a</code><ul>
<li><code>text1.txt</code></li>
<li>...</li>
</ul>
</li>
<li><code>class_b</code><ul>
<li><code>text1.txt</code></li>
<li>...</li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='In this instance, test and validation have very similar meanings. Both are the dataset which is used to calculate the metrics during training (such as accuracy or F1Score)' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now that we have the dataset, and we know the format it is in, let's pick a viable model to train with</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Picking-a-Model-with-the-Hub">Picking a Model with the Hub<a class="anchor-link" href="#Picking-a-Model-with-the-Hub"> </a></h2><p>AdaptNLP has a <a href="/adaptnlp/model_hub.html#HFModelHub"><code>HFModelHub</code></a> class that allows you to communicate with the HuggingFace Hub and pick a model from it, as well as a namespace <code>HF_TASKS</code> class with a list of valid tasks we can search by.</p>
<p>Let's try and find one suitable for sequence classification.</p>
<p>First we need to import the class and generate an instance of it:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">adaptnlp</span> <span class="kn">import</span> <span class="n">HFModelHub</span><span class="p">,</span> <span class="n">HF_TASKS</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hub</span> <span class="o">=</span> <span class="n">HFModelHub</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next we can search for a model:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="n">hub</span><span class="o">.</span><span class="n">search_model_by_task</span><span class="p">(</span>
    <span class="n">task</span><span class="o">=</span><span class="n">HF_TASKS</span><span class="o">.</span><span class="n">TEXT_CLASSIFICATION</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's look at a few:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">models</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[Model Name: distilbert-base-uncased-finetuned-sst-2-english, Tasks: [text-classification],
 Model Name: roberta-base-openai-detector, Tasks: [text-classification],
 Model Name: roberta-large-mnli, Tasks: [text-classification],
 Model Name: roberta-large-openai-detector, Tasks: [text-classification]]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These are models specifically tagged with the <code>text-classification</code> tag, so you may not see a few models you would expect such as <code>bert_base_cased</code>.</p>
<p>We'll use that first model, <code>distilbert-base-uncased</code>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">model</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Model Name: distilbert-base-uncased-finetuned-sst-2-english, Tasks: [text-classification]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now that we have picked a model, let's use the data API to prepare our data</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='It should be mentioned that this is optional, you can always just pass in the string name of a model such as "bert-base-cased"' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Building-TaskDatasets-with-SequenceClassificationDatasets">Building <a href="/adaptnlp/training.core.html#TaskDatasets"><code>TaskDatasets</code></a> with <a href="/adaptnlp/training.sequence_classification.html#SequenceClassificationDatasets"><code>SequenceClassificationDatasets</code></a><a class="anchor-link" href="#Building-TaskDatasets-with-SequenceClassificationDatasets"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Each task has a high-level data wrapper around the <a href="/adaptnlp/training.core.html#TaskDatasets"><code>TaskDatasets</code></a> class. In our case this is the <a href="/adaptnlp/training.sequence_classification.html#SequenceClassificationDatasets"><code>SequenceClassificationDatasets</code></a> class:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">adaptnlp</span> <span class="kn">import</span> <span class="n">SequenceClassificationDatasets</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are multiple different constructors for the <a href="/adaptnlp/training.sequence_classification.html#SequenceClassificationDatasets"><code>SequenceClassificationDatasets</code></a> class, and you should never call the main constructor directly.</p>
<p>We will be using <code>from_folders</code> method:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="SequenceClassificationDatasets.from_folders" class="doc_header"><code>SequenceClassificationDatasets.from_folders</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/sequence_classification.py#L150" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>SequenceClassificationDatasets.from_folders</code>(<strong><code>train_path</code></strong>:<code>Path</code>, <strong><code>get_label</code></strong>:<code>callable</code>, <strong><code>tokenizer_name</code></strong>:<code>str</code>, <strong><code>tokenize</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>is_multicategory</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>label_delim</code></strong>=<em><code>'_'</code></em>, <strong><code>valid_path</code></strong>:<code>Path</code>=<em><code>None</code></em>, <strong><code>split_func</code></strong>=<em><code>None</code></em>, <strong><code>split_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>tokenize_kwargs</code></strong>:<code>dict</code>=<em><code>{}</code></em>, <strong><code>auto_kwargs</code></strong>:<code>dict</code>=<em><code>{}</code></em>)</p>
</blockquote>
<p>Builds <a href="/adaptnlp/training.sequence_classification.html#SequenceClassificationDatasets"><code>SequenceClassificationDatasets</code></a> from a folder or groups of folders</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>train_path</code></strong> : <em><code>&lt;class 'pathlib.Path'&gt;</code></em>    <p>The path to the training data</p></li>
</ul>
<ul>
<li><strong><code>get_label</code></strong> : <em><code>&lt;built-in function callable&gt;</code></em>   <p>A function which grabs the label(s) given a text files `Path`</p></li>
</ul>
<ul>
<li><strong><code>tokenizer_name</code></strong> : <em><code>&lt;class 'str'&gt;</code></em> <p>The name of the tokenizer</p></li>
</ul>
<ul>
<li><strong><code>tokenize</code></strong> : <em><code>&lt;class 'bool'&gt;</code></em>, <em>optional</em>  <p>Whether to tokenize immediatly</p></li>
</ul>
<ul>
<li><strong><code>is_multicategory</code></strong> : <em><code>&lt;class 'bool'&gt;</code></em>, <em>optional</em>  <p>Whether each item has a single label or multiple labels</p></li>
</ul>
<ul>
<li><strong><code>label_delim</code></strong> : <em><code>&lt;class 'str'&gt;</code></em>, <em>optional</em>    <p>if `is_multicategory`, how to separate the labels</p></li>
</ul>
<ul>
<li><strong><code>valid_path</code></strong> : <em><code>&lt;class 'pathlib.Path'&gt;</code></em>, <em>optional</em>    <p>The path to the validation data</p></li>
</ul>
<ul>
<li><strong><code>split_func</code></strong> : <em><code>&lt;class 'NoneType'&gt;</code></em>, <em>optional</em>    <p>Optionally a splitting function similar to RandomSplitter</p></li>
</ul>
<ul>
<li><strong><code>split_pct</code></strong> : <em><code>&lt;class 'float'&gt;</code></em>, <em>optional</em>    <p>What % to split the items in the `train_path`</p></li>
</ul>
<ul>
<li><strong><code>tokenize_kwargs</code></strong> : <em><code>&lt;class 'dict'&gt;</code></em>, <em>optional</em>   <p>kwargs for the tokenize function</p></li>
</ul>
<ul>
<li><strong><code>auto_kwargs</code></strong> : <em><code>&lt;class 'dict'&gt;</code></em>, <em>optional</em>   <p>kwargs for the AutoTokenizer.from_pretrained constructor</p></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Anything you would normally pass to the tokenizer call (such as <code>max_length</code>, <code>padding</code>) should go in <code>tokenize_kwargs</code>, and anything going to the <code>AutoTokenizer.from_pretrained</code> constructor should be passed to the <code>auto_kwargs</code>.</p>
<p>In our case we have a <code>train_path</code> and <code>valid_path</code>, and the last thing we need to do is write a way to get the label from an individual file.</p>
<p>Let's look at what one of these look like:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">item</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_path</span><span class="o">/</span><span class="s1">&#39;train&#39;</span><span class="o">/</span><span class="s1">&#39;pos&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ls</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">item</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Path(&#39;/root/.fastai/data/imdb/train/pos/3205_8.txt&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So the label is located in the <em>name</em> of the <strong>parent</strong> relative to the actual file:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">item</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;pos&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's write a quick function to extract that:
{% include note.html content='The items get passed in as string file locations, so we should convert them to a Path to utilize the <code>.parent.name</code> functionality' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="k">def</span> <span class="nf">get_y</span><span class="p">(</span><span class="n">item</span><span class="p">:</span><span class="nb">str</span><span class="p">):</span> <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next we'll build our <a href="/adaptnlp/training.sequence_classification.html#SequenceClassificationDatasets"><code>SequenceClassificationDatasets</code></a>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dsets</span> <span class="o">=</span> <span class="n">SequenceClassificationDatasets</span><span class="o">.</span><span class="n">from_folders</span><span class="p">(</span>
    <span class="n">data_path</span><span class="o">/</span><span class="s1">&#39;train&#39;</span><span class="p">,</span>
    <span class="n">get_label</span><span class="o">=</span><span class="n">get_y</span><span class="p">,</span>
    <span class="n">valid_path</span><span class="o">=</span><span class="n">data_path</span><span class="o">/</span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
    <span class="n">tokenizer_name</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
    <span class="n">tokenize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">split_func</span><span class="o">=</span><span class="n">get_y</span><span class="p">,</span>
    <span class="n">tokenize_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;max_length&#39;</span><span class="p">:</span><span class="mi">128</span><span class="p">,</span> <span class="s1">&#39;truncation&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;padding&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Using custom data configuration default-1f2b71eec4880b46
Reusing dataset text_no_new_line (/root/.cache/huggingface/datasets/text_no_new_line/default-1f2b71eec4880b46/0.0.0)
Using custom data configuration default-04d8fbd2bd2108a0
Reusing dataset text_no_new_line (/root/.cache/huggingface/datasets/text_no_new_line/default-04d8fbd2bd2108a0/0.0.0)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='If you only have a training folder, just pass in a <code>split_func</code> or <code>split_pct</code> to either have it split the dataset in a custom way, or pass in a percentage to randomly split by' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And finally turn it into some <a href="/adaptnlp/training.core.html#AdaptiveDataLoaders"><code>AdaptiveDataLoaders</code></a>.</p>
<p>These are just fastai's <code>DataLoaders</code> class, but it overrides a few functions to have it work nicely with HuggingFace's <code>Dataset</code> class</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="SequenceClassificationDatasets.dataloaders" class="doc_header"><code>SequenceClassificationDatasets.dataloaders</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/sequence_classification.py#L208" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>SequenceClassificationDatasets.dataloaders</code>(<strong><code>batch_size</code></strong>=<em><code>8</code></em>, <strong><code>shuffle_train</code></strong>=<em><code>True</code></em>, <strong><code>collate_fn</code></strong>=<em><code>None</code></em>, <strong><code>path</code></strong>=<em><code>'.'</code></em>, <strong><code>device</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Build DataLoaders from <code>self</code></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>batch_size</code></strong> : <em><code>&lt;class 'int'&gt;</code></em>, <em>optional</em> <p>A batch size</p></li>
</ul>
<ul>
<li><strong><code>shuffle_train</code></strong> : <em><code>&lt;class 'bool'&gt;</code></em>, <em>optional</em> <p>Whether to shuffle the training dataset</p></li>
</ul>
<ul>
<li><strong><code>collate_fn</code></strong> : <em><code>&lt;class 'NoneType'&gt;</code></em>, <em>optional</em>    <p>A custom collation function</p></li>
</ul>
<ul>
<li><p><strong><code>path</code></strong> : <em><code>&lt;class 'str'&gt;</code></em>, <em>optional</em></p>
</li>
<li><p><strong><code>device</code></strong> : <em><code>&lt;class 'NoneType'&gt;</code></em>, <em>optional</em></p>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span> <span class="o">=</span> <span class="n">dsets</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally, let's view a batch of data with the <code>show_batch</code> function:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span><span class="o">.</span><span class="n">show_batch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Input</th>
      <th>Label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>i originally scored sarah's show with a nice fat 8, but i've struggled a bit with her humor of late and a thin 7 is what's settled in. i shall explain. &lt; br / &gt; &lt; br / &gt; you will either like sarah's humor, or you won't. if you don't, i doubt anyone could persuade you. you folks know who you are and it's perfectly fine, but then you know that too. moving on, the first season gave us fantastic bits about sarah, her friends and family, and her pursuits in life. in one memorable episode, she</td>
      <td>pos</td>
    </tr>
    <tr>
      <th>1</th>
      <td>oh my goodness. this was a real big mess that just couldn't help itself. jeffrey ( jon heder ) is a 29 year old man still living with his mum ( diane keaton ) and not planning on going anywhere. until his mother meets a rich businessman named mert ( jeff daniels ) who she may be getting married to. &lt; br / &gt; &lt; br / &gt; it would have been an ok movie if heder didn't play his jeffrey so annoying, from the very start there is no chance of liking him and it only gets worse and worse. in the end, we are supposed to like him,</td>
      <td>neg</td>
    </tr>
    <tr>
      <th>2</th>
      <td>i've seen enough of both little richard in interviews and in performances and enough of poor leon pigeonholed into these 50s / 60s musical bio pics to know that leon was not the right actor for this role. leon was so right as david ruffin in the temptations, but fails utterly to capture the essence of little richard in this film. &lt; br / &gt; &lt; br / &gt; actor miguel nunez who played little richard in " why do fools fall in love? " was a much more suitable choice, having pulled off the musician's powerful but effeminate persona. &lt; br / &gt; &lt; br / &gt;</td>
      <td>neg</td>
    </tr>
    <tr>
      <th>3</th>
      <td>a fine story about following your dreams and actually taking a stab at doing something about them when the chance strikes. nothing was easy for morris either - he had a family, job, job opps elsewheres, a mortgage, etc - it wasn't like he could just drop what he was doing and blithely hop on the greyhound to play aaa ball for 4 months. it took guts. i am glad that they showed his indecision, almost up'til he got the callup to the majors. &lt; br / &gt; &lt; br / &gt; i can remember seeing him pitch against the red sox ( i think</td>
      <td>pos</td>
    </tr>
    <tr>
      <th>4</th>
      <td>a visit by hitler in rome is the backdrop of this tender story of love, friendship, homosexuality and fascism. sophia loren plays the housewife and mother of six children who stays at home while her entire family go to the military parade in honor of hitler and mussolini. she has to stay at home since the family cannot afford a maid. she would have loved to go though as she along with the entire housing complex where she lives is an ardent admirer of il duce. &lt; br / &gt; &lt; br / &gt; there is one exception though. across the yard sits marcello mastroianni on his chair contemplating suicide. the</td>
      <td>pos</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Building-Tuner">Building <code>Tuner</code><a class="anchor-link" href="#Building-Tuner"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next we need to build a compatible <code>Tuner</code> for our problem. These tuners contain good defaults for our problem space, including loss functions and metrics.</p>
<p>First let's import the <a href="/adaptnlp/training.sequence_classification.html#SequenceClassificationTuner"><code>SequenceClassificationTuner</code></a> and view it's documentation</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">adaptnlp</span> <span class="kn">import</span> <span class="n">SequenceClassificationTuner</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SequenceClassificationTuner" class="doc_header"><code>class</code> <code>SequenceClassificationTuner</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/sequence_classification.py#L222" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SequenceClassificationTuner</code>(<strong><code>dls</code></strong>:<code>DataLoaders</code>, <strong><code>model_name</code></strong>:<code>str</code>, <strong><code>tokenizer</code></strong>=<em><code>None</code></em>, <strong><code>loss_func</code></strong>=<em><code>CrossEntropyLoss()</code></em>, <strong><code>metrics</code></strong>=<em><code>[&lt;function accuracy at 0x7fa3dc502940&gt;, &lt;fastai.metrics.AccumMetric object at 0x7fa3dc337400&gt;]</code></em>, <strong><code>opt_func</code></strong>=<em><code>Adam</code></em>, <strong><code>additional_cbs</code></strong>=<em><code>None</code></em>, <strong><code>expose_fastai_api</code></strong>=<em><code>False</code></em>, <strong><code>num_classes</code></strong>:<code>int</code>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>) :: <a href="/adaptnlp/training.core.html#AdaptiveTuner"><code>AdaptiveTuner</code></a></p>
</blockquote>
<p>An <a href="/adaptnlp/training.core.html#AdaptiveTuner"><code>AdaptiveTuner</code></a> with good defaults for Sequence Classification tasks</p>
<p><strong>Valid kwargs and defaults:</strong></p>
<ul>
<li><code>lr</code>:float = 0.001</li>
<li><code>splitter</code>:function = <code>trainable_params</code></li>
<li><code>cbs</code>:list = None</li>
<li><code>path</code>:Path = None</li>
<li><code>model_dir</code>:Path = 'models'</li>
<li><code>wd</code>:float = None</li>
<li><code>wd_bn_bias</code>:bool = False</li>
<li><code>train_bn</code>:bool = True</li>
<li><code>moms</code>: tuple(float) = (0.95, 0.85, 0.95)</li>
</ul>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>dls</code></strong> : <em><code>&lt;class 'fastai.data.core.DataLoaders'&gt;</code></em>   <p>A set of DataLoaders</p></li>
</ul>
<ul>
<li><strong><code>model_name</code></strong> : <em><code>&lt;class 'str'&gt;</code></em> <p>A HuggingFace model</p></li>
</ul>
<ul>
<li><strong><code>tokenizer</code></strong> : <em><code>&lt;class 'NoneType'&gt;</code></em>, <em>optional</em> <p>A HuggingFace tokenizer</p></li>
</ul>
<ul>
<li><strong><code>loss_func</code></strong> : <em><code>&lt;class 'fastai.losses.CrossEntropyLossFlat'&gt;</code></em>, <em>optional</em>   <p>A loss function</p></li>
</ul>
<ul>
<li><strong><code>metrics</code></strong> : <em><code>&lt;class 'list'&gt;</code></em>, <em>optional</em>   <p>Metrics to monitor the training with</p></li>
</ul>
<ul>
<li><strong><code>opt_func</code></strong> : <em><code>&lt;class 'function'&gt;</code></em>, <em>optional</em>  <p>A fastai or torch Optimizer</p></li>
</ul>
<ul>
<li><strong><code>additional_cbs</code></strong> : <em><code>&lt;class 'NoneType'&gt;</code></em>, <em>optional</em>    <p>Additional Callbacks to have always tied to the Tuner,</p></li>
</ul>
<ul>
<li><strong><code>expose_fastai_api</code></strong> : <em><code>&lt;class 'bool'&gt;</code></em>, <em>optional</em> <p>Whether to expose the fastai API</p></li>
</ul>
<ul>
<li><strong><code>num_classes</code></strong> : <em><code>&lt;class 'int'&gt;</code></em>, <em>optional</em>    <p>The number of classes</p></li>
</ul>
<ul>
<li><strong><code>kwargs</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next we'll pass in our <code>DataLoaders</code> and the name of our model:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>{% include note.html content='If you are <strong>not</strong> using the data API (<a href="/adaptnlp/training.core.html#TaskDatasets"><code>TaskDatasets</code></a>, <a href="/adaptnlp/training.sequence_classification.html#SequenceClassificationDatasets"><code>SequenceClassificationDatasets</code></a>, etc), you need to pass in the tokenizer to the constructor as well withÂ <code>tokenizer=tokenizer</code>' %}</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tuner</span> <span class="o">=</span> <span class="n">SequenceClassificationTuner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>By default we can see that it used <code>CrossEntropyLoss</code> as our loss function, and both <code>accuracy</code> and <code>F1Score</code> as our metrics:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tuner</span><span class="o">.</span><span class="n">loss_func</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>FlattenedLoss of CrossEntropyLoss()</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">tuner</span><span class="o">.</span><span class="n">metrics</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>accuracy
f1_score
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It is also possible to define your own metrics, these stem from <a href="https://docs.fast.ai/metrics">fastai</a>.</p>
<p>To do so, write a function that takes an input and an output, and performs an operation. For example, we will write our own <code>accuracy</code> metric:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">ourAccuracy</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
    <span class="s2">&quot;A simplified accuracy metric that doesn&#39;t flatten&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">inp</span> <span class="o">==</span> <span class="n">targ</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And then we pass it into the constructor:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tuner</span> <span class="o">=</span> <span class="n">SequenceClassificationTuner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">ourAccuracy</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If we look at the metrics, you can see that now it is just <code>ourAccuracy</code>:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tuner</span><span class="o">.</span><span class="n">metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;ourAccuracy&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For this tutorial, we will revert it back to the defaults:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tuner</span> <span class="o">=</span> <span class="n">SequenceClassificationTuner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally we just need to train our model!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Fine-Tuning">Fine-Tuning<a class="anchor-link" href="#Fine-Tuning"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And all that's left is to <code>tune</code>. There are only 4 or 5 functions you can call on our <code>tuner</code> currently, and this is by design to make it simplistic. In case you don't want to be boxed in however, if you pass in <code>expose_fastai_api=True</code> to our earlier call, it will expose the entirety of <code>Learner</code> to you, so you can call <code>fit_one_cycle</code>, <code>lr_find</code>, and everything else as <code>Tuner</code> uses <code>fastai</code> under the hood.</p>
<p>First, let's call <code>lr_find</code>, which uses fastai's Learning Rate Finder to help us pick a learning rate.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="AdaptiveTuner.lr_find" class="doc_header"><code>AdaptiveTuner.lr_find</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L385" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>AdaptiveTuner.lr_find</code>(<strong><code>start_lr</code></strong>=<em><code>1e-07</code></em>, <strong><code>end_lr</code></strong>=<em><code>10</code></em>, <strong><code>num_it</code></strong>=<em><code>100</code></em>, <strong><code>stop_div</code></strong>=<em><code>True</code></em>, <strong><code>show_plot</code></strong>=<em><code>True</code></em>, <strong><code>suggest_funcs</code></strong>=<em><code>valley</code></em>)</p>
</blockquote>
<p>Runs fastai's <code>LR Finder</code></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><p><strong><code>start_lr</code></strong> : <em><code>&lt;class 'float'&gt;</code></em>, <em>optional</em></p>
</li>
<li><p><strong><code>end_lr</code></strong> : <em><code>&lt;class 'int'&gt;</code></em>, <em>optional</em></p>
</li>
<li><p><strong><code>num_it</code></strong> : <em><code>&lt;class 'int'&gt;</code></em>, <em>optional</em></p>
</li>
<li><p><strong><code>stop_div</code></strong> : <em><code>&lt;class 'bool'&gt;</code></em>, <em>optional</em></p>
</li>
<li><p><strong><code>show_plot</code></strong> : <em><code>&lt;class 'bool'&gt;</code></em>, <em>optional</em></p>
</li>
<li><p><strong><code>suggest_funcs</code></strong> : <em><code>&lt;class 'function'&gt;</code></em>, <em>optional</em></p>
</li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tuner</span><span class="o">.</span><span class="n">lr_find</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/opt/venv/lib/python3.8/site-packages/fastai/callback/schedule.py:270: UserWarning: color is redundantly defined by the &#39;color&#39; keyword argument and the fmt string &#34;ro&#34; (-&gt; color=&#39;r&#39;). The keyword argument will take precedence.
  ax.plot(val, idx, &#39;ro&#39;, label=nm, c=color)
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>SuggestedLRs(valley=0.0003981071640737355)</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYIAAAEKCAYAAAAfGVI8AAAAOXRFWHRTb2Z0d2FyZQBNYXRwbG90bGliIHZlcnNpb24zLjQuMiwgaHR0cHM6Ly9tYXRwbG90bGliLm9yZy8rg+JYAAAACXBIWXMAAAsTAAALEwEAmpwYAAAzhUlEQVR4nO3dd3ib5bn48e8tec84tuMMO3F24gyS4ASSMFIIEMosO6WFllBGy6Gl/dHS0x5KORzoOB0HSltGWQUa0jBbRhgJMwHsQMgg23ZiO/FKHG/ZkvX8/pDsKLZsy45kWdL9uS5fsd73lXS/kaVbz3jvR4wxKKWUilyWYAeglFIquDQRKKVUhNNEoJRSEU4TgVJKRThNBEopFeE0ESilVISLCnYA/ZWRkWFyc3ODHYZSSoWUjRs31hhjMr3tC7lEkJubS2FhYbDDUEqpkCIi+3rap11DSikV4TQRKKVUhNNEoJRSES7kxgiUUqondrudsrIybDZbsEMJmri4OLKzs4mOjvb5PpoIlFJho6ysjOTkZHJzcxGRYIcz6IwxHDp0iLKyMsaPH+/z/bRrSCkVNmw2G+np6RGZBABEhPT09H63iDQRKJrbHGzcV4vN3h7sUJQ6bpGaBDoM5Py1ayhClR5uZu2OKtbuqGJD0SHaHE7yRqXw56vnkZuRGOzwlIoISUlJNDY2UlJSwvnnn8/WrVuDEocmghCxYe8hxgyLZ2x6wnE/1k1/38gb2yoAGJ+RyDdPHsf4jER+u2YnFzzwIb+5bDbnzhp13M+j1JC3eRW8czfUlUFqNpx5J8y+IthRDTrtGgoB9nYnK54s4Hdv7Tzux2puc/DmlxWcN2sUa390Ouv+3xL+6/w8vnHyOF699RQmjEji5mc+45f/2kabw+mH6JUaojavgn/dCnWlgHH9+69bXdsH6I477uDBBx/svH3XXXdxzz33cOaZZzJv3jxmzZrFyy+/3OtjtLe3c/vttzN//nxmz57NQw89BMA111zDSy+91Hnc1Vdf3edj+UoTQQjYdqCe5rZ2dhxsOO7H2n6wHqeBi+eOYUJm0jH7stMS+OeNC7lu8Xge/6iEqx7eQKtDxw1UmHrnbrC3HLvN3uLaPkBXXnklq1YdTSSrVq3i2muv5cUXX+Szzz5j3bp1/OhHP6K3JYL/9re/kZqaSkFBAQUFBTzyyCMUFxezYsUKnnjiCQDq6upYv34955133oBj9aRdQyGgsOQwAHurG2lzOImJGnj+3lJWB8CsMale98dEWbjzgjwmjkjkZy9u5dPiw5w62WudKqVCW11Z/7b7YO7cuVRVVXHgwAGqq6tJS0tj5MiR3Hbbbbz//vtYLBbKy8uprKxk5MiRXh/jzTffZPPmzaxevdoVTl0du3fv5uyzz+a73/0u1dXVPP/881x66aVERfnnI1wTQQgocCcCh9NQXNPE1JHJA36szeV1ZCTFkpUS2+txF88Zwy9e3sb6vYc0EajwlJrt7hbysv04XH755axevZqKigquvPJKnnnmGaqrq9m4cSPR0dHk5ub2Or3TGMMDDzzAOeec023fNddcw9NPP83KlSt5/PHHjytOT9o1NMQZYygsqWXG6BQAdlTUH9fjbS2vY9aYlD6nmCXGRnFCzjA27D10XM+n1JB15p0QHX/stuh41/bjcOWVV7Jy5UpWr17N5ZdfTl1dHSNGjCA6Opp169axb1+PRUABOOecc/jLX/6C3W4HYNeuXTQ1NQHwrW99iz/+8Y8A5OXlHVecnjQRDHFFNU0camrjqvk5WC3CrsqBjxM0tznYU9XYY7dQV4smprOlvI4Gm33Az6nUkDX7CrjgfkjNAcT17wX3H/esoRkzZtDQ0MCYMWMYNWoUV199NYWFhcyaNYunnnqKadOm9Xr/66+/nry8PObNm8fMmTO58cYbcTgcAGRlZTF9+nS+/e1vH1eMXWnX0BBXUOzqFlo0KYMJGYnsrBh4IugYKJ6VPcyn4xdOSOeBtXsoKDnMGdOyBvy8Sg1Zs68IyHTRLVu2dP6ekZHBhg0bvB7X2NgIuNZZ6biGwGKxcO+993Lvvfd2O765uZndu3ezfPlyv8ariWCIKyipJT0xhgkZiUwdmcwXZUcG/Fh9DRR3NW9cGjFWCxv2HtJEEEBvbD1IVUMrwxJiSEuIJi0hhhHJsYxIiQt2aGoIefvtt1mxYgW33XYbqam+vYd9pYlgiCvcd5j83DREhKlZyfx780EaWx0kxfb/pfN1oLhDXLSVeeOGsaFIxwkCZVVBKT9+frPXfefNGsVPlk3zy0WEKvQtXbq0z/GFgdJEMIRV1dvYd6iZb548DqBzttCuygbmjU3r9+P5OlDsaeGEDP74zi6ONLcxLCGm38+pera1vI6fv7yVxZPS+cOVc6hrtnOkxU5tUxtbyut49INi3vqykmsXjeOWMyaTGu97WWGl+kMHi4ewgpJaAObnDgc8EkEP4wTNbQ7e+rLS68UqnQPFPo4PdFg4MR1j4BP3WIXqmb3d9yux65rt3PzMRtITY7j/qrmMSI5jclYy83OHc/aMkfzo7Km8e/sSLp47mkc/LGbJb9ex8tP9AYw+fPR2sVYkGMj5ayIYwgpKDhMfbSXPPXU0Jy2BhBgrO3pIBI9/VMJ3niqkcF9tt32dA8U+jg90OCEnlbhoi04j7YXTafjfNTuZ+Ys1fFF6xKfjb1u1iYo6G3++eh7pSd676rJS4vjNZSfw7/84hclZydzxwha+PHB804fDXVxcHIcOHYrYZNCxHkFcXP/Gl7RraAgrKDnM3LHDiLa68rXFIkzOSu5xCunaHVUAPFdQ2tmK6LC5nwPFHWKjrMzPHc7HOk7gVXObgx+t+oLXt1YgAo99VMz/XTW31/s8uG4Pa3dU8d8XzWCuD118M0an8sg1+Sz+1VoefHcPD359nr/CDzvZ2dmUlZVRXV0d7FCCpmOFsv7QRDBENdjsbD9Yz3+cMfmY7VOzknhne1W342ub2vh8fy1x0RZe3XyQX1yQR3Lc0T7lLf0cKPZ08oR0frtmJ4caW3v89uppZ0UDEzITOxNYuKqos3H9UwVsO1DPz8+bTlltC898so+fn5dHZrL3/6cPdlfz+7d3cfGc0XzDPfbji9T4aL65cBx/fW8vRdWN3epEKZfo6Oh+rcylXML7nRrCPtt/BKeh2zf7qSNTONTURnVD6zHb399djdPAHcum0WJv59+bDx6zf2t5HbOzUwe0aMXCiekAfFzU9zjB1vI6zvnj+/x9Q2BmNwwVm8uOcOGfPqS4uom/XZvP9adO4Bsnj8PebniuwHtffktbO7f/czOTRyRx7yWz+v1arDhlPDFWC395d68/TkGpTpoIhqjCksNYLcLcscOO2T416+jMIU9rd1SRnhjDNxfmMiUriecKjtZQ6RgontnPbqEOs8ekkhQbxYaimj6PfeSDIgDe/LJiQM811Bnj+qC//K8biLZaeP67izqvsZg0IonFk9J55pP9OLwMHD/2UTEV9Tb++6KZJMT0vzGekRTL8gVjefHzcsqPtPR9B6V8FNBEICLLRGSniOwRkTu87P+DiGxy/+wSkSOBjCeUfFp8mBmjU0jscr1Ax8whzwHjdqfhvV3VnD41E6tFuCI/h02lRzqTxUAHijtEWS3Mz01jfR8DxgeOtPDq5oMkx0ZRUFJLXXN4laboGA/4yfNbyM9N4+VbFjNtZMoxx3zz5FwO1tl4Z8ex3Xc1ja385d29nJWXxUkT0gccww2nTQDg4fe0VaD8J2CJQESswIPAuUAesFxEjqmSZIy5zRgzxxgzB3gAeCFQ8YSSNoeTTaVHyB83vNu+zORY0hNjjplC+vn+Wo402zlj2ggALpmXTbRVOlsFAx0o9rRwYjpF1U1U1vdcNfHJ9SU4jeF/LplFu9Pw7q7uYxmhandlAxf96SNe3FTOD5ZO5qnrTiLDy3jJ0ukjGJ0a161r7P53dtNib+eOc3uvM9OX0cPiuWTeGFYWlHbrHlRqoALZIlgA7DHGFBlj2oCVwEW9HL8c+EcA4wkZWw/U0epwMj/X+4ySKVnJ7PDoGlq7owqrRTrLRQ9PjOGsvCxe/LycNoeTLeV1ZCYPbKC4w8IJGQA9zh5qbHXw7Kf7OXfWKM6bNYr0xBivg9qh6I2tB7nwTx9R29zG0ytO4gdLp2C1eO/fj7Ja+PpJY/lwTw17q111ZIqqG3n2k/0sX5DDRD8M8t68ZBL2did/+7D4uB9LKQhsIhgDeBb7LnNv60ZExgHjgbU97L9BRApFpDASpoV1FJrLz+3eIgBX99DuygacTtdc6XU7q8kfl3bMladX5OdwuKmNt7dXuq8oHthAcYe80SmkxEWxfo/3RLCqoJQGm4PvnDoBq0X4yrQRvLuzql8XWQ1FrY52fvrCFiZnJfHaraeyeFJGn/e5cv5Yoq3S2Sr49Rs7iI2y8P0zp/glpvEZiXx11iie/nhf2HW/qeAYKoPFVwGrjTFe10U0xjxsjMk3xuRnZob3Iil7qxt57KNiJo9I6nEK4tSRyTS3tVNW28LBuha2H6zv7BbqcOrkTEanxvHE+pLjGijuYLUIJ09I563tlZ3fdDs42p089lEx83PTmJMzDIAzp42g3uZgo5eL24LlSHNbZ/L01dtfVlHbbOdHZ0/1uQhcZnIsX501iuc3lvHermrWbKvkptMn9vh6DsT3vjKJxlYHT6wv8dtjqsgVyERQDuR43M52b/PmKrRbiJ0VDVz50Me0Ow0PfL3ni5KODhjXs26Hq4XUNRFYLcJlJ2bzafHh4xoo9vTDs6dgEbj8rxvY7FEFdc22SspqW7j+1Amd206dkkmM1cI72yuP+3n9Yd+hJk6+7x0e+6h/3SnPFZYyOjWOU3xoCXi6ZuE4Glod3Pz0RrJSYo/5v/GH6aNSODsvi4fe30tZbbNfH1sNLU2tDj7aU8Mf3trF1vK6gDxHIBNBATBZRMaLSAyuD/tXuh4kItOANMB7we4IsbW8jqse3oDVAitvWNhtNoqnKR5TSNfuqGLMsHgmjeje93x5/tE87I9EMG1kCv+8aREJMVaWP/wxH+6uwRjDIx8UMS49gaXTj5aqToqN4qQJw4fMOMFv3tiJze7kqQ37fG4VlB9p4YPd1VyWn9PjmEBP5o1NI29UCs1t7fzorKnEx1gHEnav7rzANffi5y9tjdiSCuFqa3kd//3vL7nwTx8y+5dvcvWjn/DA2t1s8qGEyUAELBEYYxzALcAaYDuwyhizTUTuFpELPQ69ClhpIvgv+fP9tSx/5GMSYqJYdeNCrx/qnpJio8hOi2dzWR0f7anhjGkjvPb/5wxP4JRJGYxMiTuugWJP4zMSef7mRWSnJXDdEwX8Zs1ONpUeYcUp47t9WC6dnkVRTRNFXbqSerKrsoEDAZgf/9n+Wl7dcpDZ2ansP9zMh3v6vh4C4PmNZRgDl5/Y/zVsRYQfL5vKZSdmc+kA7u+L7LQEbj9nKu/urOblTQcC8hxq8DW1Ovj6Ix/z9Mf7iI+2cvPpE3nyugV88Yuz+3U1en8EtMSEMeY14LUu2+7scvuuQMYw1O2saOAbj35CRnIsz1x/EtlpvtWenzYymXd2VNHuNN26hTz9/ooTONJiP66B4q6yUuJYdeNCrnuygL+8u5fU+Ggu8/Jhd8a0EfzilW2s3VHlU0mE654oYHhiDC9/b7Hf4jXGcN9r28lIiuXJby/gzN+/xzOf7OO0Kb2PNTmdhlWFpSyelE7O8IGtB7Bk6giWTO35tfGHaxbm8vKmA/zyX9s4dXKGTyVA1ND2wmdl1NscPH/zIk4c1/9y8wMxVAaLI9aabRU0tbWz8oaTfU4C4Ooeanca4qItnSUgvBmREtfZleRPqQnRPL3iJJYvyOFn5033eqVszvAEpmYl87YP4wQHjrRQVtvC5rK6zvLb/vDml5UUlNRy21mTSUuM4fL8bN7eXtXr9RAAG4oOUVbbwhX5Ob0eF2xWi/Cby2bT2Orgnle3BzscdZycTsPjH5VwQs6wQUsCoIkg6IprmhgzLJ5RqfH9ul/HgPGiiRnERfu//9kX8TFW7rtkdq8flmdOH+HTVcYds4uircKj7jIVx8ve7uTXr+9g0ogkrnTHuHz+WNqdhlUFpb3e97mCUlLjozlnxki/xBJIU7KSuXnJJF78vJx3dw6NMRk1MO/trqaoponrFucO6vNqIgiyopomxmck9vt+HdNBPQdoh6Izp2f5dJXxxn21xEdbWXHKBN7aXklJTdNxP/fKT/dTVNPEHcumEeWuhJqbkcgpkzL4x6f7ae9h0Liu2c4b2yq4eM7ooCXZ/vreVyYyMTORn724lf2Hmqmos3X+6LUGoeOxD4vJSonl3JmjBvV5NREEkTGG4upGcjP63wc9MTOJF767iCvnD+2uizk5w3y6yrhw32Hm5AzjulNyibZYeLyf0zy7arDZ+ePbuzlp/HDOnH5sP/3VJ43lQJ2N93pITi9/4boi+/Ih3i3kKTbKyq8vnU35kRZO++06Tr7vnc6f+f/ztrYUQsDuygY+2F3DN08eR0zU4H4063oEQVTbbKfe5mB8xsDKDgxk3eLB1nGV8ZvbKnC0Ozu/mXtqanWw/WADN58+kRHJcVw4ZzSrCsv44VlTSU0Y2Dq9D71XxKGmNh4/b3q3geeleVlkJsfy7Cf7OyuHenquoJQZo1OO+yK8wZafO5x/3rSQPVXHztJ66L293PPqdk6ZlOH1/18NDY+vLyE2ysLyBWMH/bn1ryKIimtcb9gJA+gaCiVLp7uuMv60h3WPvyg9QrvTcKK7ttJ1i8fTYm/n2QGu0dtgs/PE+hLOmz2K2V7WaI62WrgiP5u1O6q6TVfdWl7HtgP1Q76l1ZP5ucNZvmDsMT93nDuNPVWN/HNjWbDDUz040tzGC5+VcfGcMUGZ+aWJIIiKql394AMZIwglp03JJC7awppt3tco6FhjuaOFkzc6hcWT0nlifTFtjv7XKnquoJTGVgc3nTaxx2Oumj8WA6wsKMUYw+f7a/npC1tY/vDHxEVbuOgEr2WxQtI5M0Zy4rg0fv/WLppaHcEOR3nxj09LsdmdfPuU3KA8vyaCICquaSLKImSn9W/GUKhJiIni9CmZrNlW6fWq3o37apmSlXRM0bzrT5lAZX0rr2052O343jjanTz+UQkLxg9nVnbPXTs5wxM4fUomT3+8j7P/8D5f+/N6Xvy8jLNmZPHPGxcNuEtqKBIR/vOr06huaO1cOEgNHfZ2J09tKGHRxPReKwoEkiaCICquaWJsekJE9NsumzmSinobmzxqFIFr3vRn+2s5scvaC6dPyWRiZiKPfljUr/IJb35ZSfmRFlac0ve6td9ePJ7DTW0kx0Xxq0tmUfCzpfz+ijm9JpBQdeK44Zw7cyQPv19EVUPv11CowdHc5mBz2RHuf2c3B+tsXLc4eGst62BxEBXXNDE+Pby7hTqcMS2LaKuwZmvFMYPcu6oaaLA5yO9y8YzFIqw4ZQL/+eIWPik+zMk+rur1qJe6Rz05fUom2355TrdV4MLVj5dN460vK/nj27u592uzgh1OSHvovb288sUBRqXGkzM8npy0BHKGJ2ARONzUxpFmO4ebXf/a2504nYZ2Y2h3GppaHeypbqSstoWO7zgn5AzrtUJAoEXGO2AIcjoNJYea+l3VMlSlxkezaGIGb2yr4I5zp3XO5Om4kCzfyyI8l8wbw32vb+e5glKfEsFn+2v5bP8R7rogz+cicZGSBMA1FnX1SWN5+pP9XLc4l0kj/H/FeSRYvbGM+17fwYzRKZQebmb93hqa27pX0I+yCMMSoomxWrBYBKtFsIoQG21ldvYwLj8xhylZSUzJSmZceiKWfhY29KfIeRcMMRX1Nmx2J+MzI6NFAK7uoZ++sIUdFQ1MH+XqC91YUktGUgxjvdTziYu2cv7sUbz0+QHuudjR54f23z4sJjkuKqTm/w+2W8+czPOflXP3v7fz4NfnkhwXPmMh/WWMYfXGMvZUNRIfYyUhxkp8TBQpcVEsnZ7l9e+tsOQw//nCFhZNTOfJ6xYQbbVgjOFwUxtlta4ZaGkJMQxLjCY5NsqvNb4CSRNBkBTXRMaMIU9n5WXxny9u4fWtFZ2JoHBfLSeOS+vxDfO1udn849NS1myr4JJ5PVfxLKtt5o2tFVx/yviI+pbfX+lJsfxg6WTueXU7J9/7DpeemM01C3O7VbxtsNldXZcZiWGbLP60dg+/e2sXMVYLbV1W0stOi+e3l51wTB2v0sPN3Pj3jYxJi+fPV88j2j22JyKkJ8WGdME/fccESZE7EUwY4MVkoSgjKZb5ucNZs7WCH541haoGG/sPN/PNXkrr5o9LI2d4PC9+Xt5rInjSvVLXtYty/Rx1+Ln+1Ank5w7nqQ0lrPy0lKc27GPxpHRmjk5lV2UDuyobKXdfX5EcF8W3F+Xy7cXjSUuMCXLk/vPoB0X87q1dXDJ3DP97+QkYoMXeTktbO7sqG/jZi1tY/sjHfGtRLj9eNhWngeufLMTe7uTRa/MZlhA+/xegiSBoiqubiI+2+m2dgFCxbMZI7v73lxRVN7KrsgGAeb1UWbRYhK/NGcOf1u2hos7GyNTuy0U2tjpY+WkpX501itHDwnsqrr/MyRnGnJw5/Oyr01lZUMozH++joLiWCZmJ5Oem8fWssYwdnsBrWw5y/9o9PPphMd88eRwrTh3PiGT3a7B5FbxzN9SVQWo2nHknzL7imOcxxrC3uokPdlfT1OogLtpKfIyV+GjXT1JcFImxUSTHRnX+nhQT1Wd/udNpKKppYnPZETaX1bGrsoHcjEROHJtGfm4aY4cn9NjKfPaT/dzz6nbOnTmS31w2u/O5kmKjSIqNIjM5lte/fxq/fmMHT6wvYd3OKkanxrOnupEnvj2fiT6UVA81mgiCpORQE7kZiSHTh+gvy2a6EsGabZUcamwlJsrCzDG9z53+2rxs7l+7h5c3lXPj6d0vEvvHJ/tpaHX4NGVUHSs9KZbvfWUS310ykXan6TaV+YITRrOrsoEH1+3hkQ+KeHx9CUumZHL9sELmb74LcbivzK4rhX/dCkDDlK9RuK+WdTuqWLezitLD/VtsSMT1oZwSF01yXBRx0VYMgDEYwGkMJTXNNLovjkuIsTJpRBL/2nSAZz9xXY2ekRRL/jhXUpifO5y80SlEWy289Hk5P3tpC0umZvJ/V83tcep2fIyVuy6cwbKZI7l99RdsKDrE3RfN4NTJ4blmuiaCICmuaSJvVHAuHgmm0cPiOSE7lTe2VWAROCE7ldio3it8js9IZO7YYbz4efdEUHq4mT+8vYvTp2QyJ2dYACMPbyJClNX7l5IpWcn831Vz+cHSKTy5voQ3tlYwes9vEUuXD3h7Cwdf+CkLba5xr/hoK4snpXPjaRNZMjWTEclxtNjbsbm7YJrb2mlqc9Boc9DY6vppsNlpsDlosDmod/9us7cjIgiuJCG4WjQnZA/jhJxhTMxMwmoR2p2G3VUNFJbU8tm+Wgr2HeYN99Xs8dFWZmWnsnFfLSeNH85fv3GiT4XdTp6QzhvfP43tB+vJzx3e5/GhShNBENjbnew/3Mx5swa31OxQcc7MkfzmjZ1EWYQVp/r2Lf6SuWP4r5e38eWBevJGuxKo02n48erNWES49xKdFx9o4zMSuevCGdx5fh5y9yGvx4zkED9ZNo280SmcNH54tzLeMVGWY64g9yerRZg2MoVpI1M6l3SsrLdRUHKYwpJaCkoOc8a0Efzhyjn9Ki+eGBsV1kkANBEERenhZtqdJqJmDHlaNsOVCBxOQ/44395g588ezd3//pIXPy8jb7Rr0fZnPt3PhqJD3HfJLMbo2MCgsVjENSZQ131xH0nN5uYlPdd4GmxZKXGcP3s0588eHexQhrTwr20wBHVOHY2gawg8TchMYkqWa8DN1+X40hJj+MrUEby06QCOdielh5u577XtnDo5g6tCtFJoSDvzTojuknyj413bVcjRRBAExZ1TRyMzEQDccNpELp2XzfB+TEm8ZN4Yqhta+XBPDT953tUl9KtLZ0fcgPuQMPsKuOB+SM0BxPXvBfd3mzWkQoN2DQVBcU0TwxKiw24ucn9cdmI2l53Y83UB3nxl2ghS46P5yfObqaxv5d6vaZdQUM2+Qj/4w4S2CIKgeIDrFEe62ChXyYnK+lZOmZTB8gXaJaSUP2giCAJNBAN37aJcFowfzq8unaVdQkr5iXYNDbLmNgcH62wRPT5wPKZkJbPqxoXBDkOpsKItgkFWUtMMMOAF65VSyt80EQyySKw6qpQa2jQRDLKSQ65EkJvRvf6+UkoFgyaCQVZU3cTIlDgSYnR4Rik1NGgiGGTFNY3aLaSUGlI0EQyy4pqmiC0toZQamgKaCERkmYjsFJE9InJHD8dcISJfisg2EXk2kPEE26HGVmqb7Tp1VCk1pASso1pErMCDwFlAGVAgIq8YY770OGYy8FNgsTGmVkRGBCqeYKuqt7HiyUIsQtiXtFVKhZZAtggWAHuMMUXGmDZgJXBRl2O+AzxojKkFMMZUBTCeoNlRUc/FD37E3upGHrkmXxdQUUoNKYFMBGMAz4LlZe5tnqYAU0TkIxH5WESWeXsgEblBRApFpLC6ujpA4QbGe7uquewvG2g3hlU3LuTM6VnBDkkppY4R7MHiKGAysARYDjwiIsO6HmSMedgYk2+Myc/MDJ01Q58r2M91TxSQMzyBl763mJljUoMdklJKdRPIRFAOeJaHzHZv81QGvGKMsRtjioFduBJDyGuw2fmvl7Zx8oTh/POmhYxK1XLJSqmhKZCJoACYLCLjRSQGuAp4pcsxL+FqDSAiGbi6iooCGNOgWbujirZ2J7ctnUJSrF48ppQaugKWCIwxDuAWYA2wHVhljNkmIneLyIXuw9YAh0TkS2AdcLsxxvuq2CHmtS0HGZEcy7yxvi3FqJRSwRLQr6rGmNeA17psu9PjdwP80P0TNprbHLy3q5or8nNcC30rpdQQFuzB4rD07s5qbHYny2aODHYoSinVJ00EAfD61gqGJ8awQC8cU0qFAE0Efmazt7N2eyVn52URZdX/XqXU0KefVH724e4amtratVtIKRUyNBH42etbK0iJi2LRxIxgh6KUUj7RROBH9nYnb2+vZGleFjFR+l+rlAoN+mnlRxv2HqKuxc65M0cFOxSllPKZJgI/en1rBYkxVk6drN1CSqnQoYnAT9qdhje3VfCVaSOIi7YGOxyllPKZJgI/+bT4MIea2vjqLO0WUkqFFk0EfrJmWwVx0RaWTA2dMtlKKQWaCPymuKaJqVnJJMRopVGlVGjRROAn9TY7KfHRwQ5DKaX6TROBn9S1aCJQSoUmTQR+Ut/iICVOE4FSKvRoIvCTepudVG0RKKVCkCYCP7DZ22lzOEmJ14FipVTo0UTgB/U2O4B2DSmlQpImAj+ob3EA6GCxUiokaSLwg7qWjhaBdg0ppUKPJgI/6Owa0haBUioEaSLwg3p3i0BnDSmlQpEmAj+ot7nHCHSwWCkVgjQR+EFHiyBZxwiUUiHIp0QgIokiYnH/PkVELhQR/frrVm+zExtl0XUIlFIhydcWwftAnIiMAd4Evgk8EaigQk291hlSSoUwXxOBGGOagUuAPxtjLgdmBC6s0FLf4tCBYqVUyPI5EYjIQuBq4FX3Nu0Hcau32fUaAqVUyPI1EfwA+CnwojFmm4hMANYFLKoQo11DSqlQ5tPXWGPMe8B7AO5B4xpjzK2BDCyU1NscjEtPDHYYSik1IL7OGnpWRFJEJBHYCnwpIrf7cL9lIrJTRPaIyB1e9n9LRKpFZJP75/r+n0LwuRal0a4hpVRo8rVrKM8YUw9cDLwOjMc1c6hHImIFHgTOBfKA5SKS5+XQ54wxc9w/j/oc+RBhjHF1DenFZEqpEOVrIoh2XzdwMfCKMcYOmD7uswDYY4wpMsa0ASuBiwYc6RDVYm/H4TQ6a0gpFbJ8TQQPASVAIvC+iIwD6vu4zxig1ON2mXtbV5eKyGYRWS0iOT7GM2RoCWqlVKjzKREYY+43xowxxnzVuOwDvuKH5/8XkGuMmQ28BTzp7SARuUFECkWksLq62g9P6z+6KI1SKtT5OlicKiK/7/gwFpHf4Wod9KYc8PyGn+3e1skYc8gY0+q++ShworcHMsY8bIzJN8bkZ2Zm+hLyoOmoM6SDxUqpUOVr19BjQANwhfunHni8j/sUAJNFZLyIxABXAa94HiAiozxuXghs9zGeIePoojTaIlBKhSZfv8ZONMZc6nH7lyKyqbc7GGMcInILsAbXVciPuS9GuxsoNMa8AtwqIhcCDuAw8K3+nkCw6aI0SqlQ52siaBGRU4wxHwKIyGKgpa87GWNeA17rsu1Oj99/iuuK5ZDVMViss4aUUqHK10RwE/CUiKS6b9cC1wYmpNCiaxEopUKdryUmvgBOEJEU9+16EfkBsDmAsYWEepudhBgr0VZd40cpFZr69elljKl3X2EM8MMAxBNy6lscOlCslAppx/M1VvwWRQjTOkNKqVB3PImgrxITEcG1FoG2CJRSoavXr7Ii0oD3D3wB4gMSUYipt9nJSo4LdhhKKTVgvSYCY0zyYAUSqupbHEweoS0CpVTo0qkux0mXqVRKhTpNBH1oczi57/XtHGlu67bP6TS6TKVSKuRpIujD1gN1PPReEe9sr+q2r6nNgdNonSGlVGjTRNCHBpurhERZbfeKGvW2jrUItGtIKRW6NBH0ocFdVK78SHO3fR3lJbTOkFIqlGki6ENHUTmvLQItQa2UCgOaCPrQ0SLovWtIE4FSKnRpIuhDxxjBgSMttDuPvbZOF6VRSoUDTQR96GgROJyGynrbMft0mUqlVDjQRNCHju4f6N491LE6WbK2CJRSIUwTQR8a3OsNAJTVHjtzqL7FQXJsFFaLFmJVSoUuTQR9qLc5mJLlKrnkrUWgA8VKqVCniaAPDTYHGUmxZCbHUt41EbTYdYlKpVTI00TQh/oWV1G57LR4yrpcVFandYaUUmFAE0EfGmyub/3ZaQleuoZ0mUqlVOjTRNALYwyNrQ5S4qPJTovvdi1BvS5TqZQKA5oIetHU1o7T4G4RxGNvN1Q1HL2WoN5m1zpDSqmQp4mgFw0e1wlkpyUAR2cOOZ3u1oJ2DSmlQpwmgl50FJzraBHA0WsJGlodGKN1hpRSoU8TQS86WgQpcdGMGeZOBIddLYKjlUd1jEApFdo0EfSio+BcclwUcdFWMpNjO7uGOgvOaYtAKRXiNBH0omstoTHD4ik/0nLMPh0jUEqFOk0Evehcb8Dd/ZOdFt85RtAxfqCzhpRSoU4TQS86xwjcH/bZaQmUH2nB6TRHWwR6HYFSKsQFNBGIyDIR2Skie0Tkjl6Ou1REjIjkBzKe/mqwOYi2CrFRrv+mo9cStHqsRaAtAqVUaAtYIhARK/AgcC6QBywXkTwvxyUD3wc+CVQsA+UqLxGNiKvMtOcU0voWOyKQFKMtAqVUaAtki2ABsMcYU2SMaQNWAhd5Oe6/gV8DNi/7gqq+xXFMdVHPi8rqba61CCy6FoFSKsQFMhGMAUo9bpe5t3USkXlAjjHm1d4eSERuEJFCESmsrq72f6Q9aLDZj5kV1LVFoN1CSqlwELTBYhGxAL8HftTXscaYh40x+caY/MzMzMAH59ZgO7ZFEBdtJSMp1t0i0DpDSqnwEMhEUA7keNzOdm/rkAzMBN4VkRLgZOCVoTRg3DURAIxJc11LUN+idYaUUuEhkImgAJgsIuNFJAa4CnilY6cxps4Yk2GMyTXG5AIfAxcaYwoDGFO/1LsHiz25riVocS9KowPFSqnQF7BEYIxxALcAa4DtwCpjzDYRuVtELgzU8/qTtxZBdlo85bUtHGlp0xaBUiosBPQrrTHmNeC1Ltvu7OHYJYGMpb/aeygznZ2WQFu7k8r6Vh0sVkqFBb2yuAeNrUcLznnqmDkEWmdIKRUeNBH04GiZ6WM/7HM8EkGqjhEopcKAJoIeeJag9jRmWELn79o1pJQKB5oIetC14FyH+BgrGUkxrn3aNaSUCgOaCHrQU4sAYIy71IS2CJRS4UATQQ+6LkrjKdu9bKVeR6CUCgeaCHrQW4ugY+aQdg0ppcKBJoIeNHS2CLongpMmDGdiZiLp7rECpZQKZdq30YMGm4PYKAuxUdZu+86YlsUZ07KCEJVSSvmftgh64K3OkFJKhSNNBD2otzk6F61XSqlwpomgB94KzimlVDjSRNCDBpuuQKaUigyaCHpQ32LXFoFSKiJoIuhBg81Bcqy2CJRS4U8TQQ90jEApFSk0EXhhb3fSYm/XMQKlVETQROBFb+UllFIq3Ggi8KKhl4JzSikVbjQReKEtAqVUJNFE4EVHCWqtLqqUigSaCLzQFoFSKpJoIvCip4XrlVIqHGki8EJbBEqpSKKJwAtNBEqpSKKJwIsGm52EGCtRVv3vUUqFP/2k88K1KI22BpRSkUETgReuOkM6UKyUigyaCLzQgnNKqUiiicCLBptdp44qpSKGJgIv6rVFoJSKIAFNBCKyTER2isgeEbnDy/6bRGSLiGwSkQ9FJC+Q8fiqwWbXMQKlVMQIWCIQESvwIHAukAcs9/JB/6wxZpYxZg7wG+D3gYqnP+ptDlK0RaCUihCBbBEsAPYYY4qMMW3ASuAizwOMMfUeNxMBE8B4fGKzt9PmcOqiNEqpiBHIr71jgFKP22XASV0PEpHvAT8EYoAzvD2QiNwA3AAwduxYvwfqSa8qVkpFmqAPFhtjHjTGTAR+Avy8h2MeNsbkG2PyMzMzAxrP0UVpNBEopSJDIBNBOZDjcTvbva0nK4GLAxiPTzpbBLHaNaSUigyBTAQFwGQRGS8iMcBVwCueB4jIZI+b5wG7AxiPTzoSgY4RKKUiRcD6P4wxDhG5BVgDWIHHjDHbRORuoNAY8wpwi4gsBexALXBtoOLxVb12DSmlIkxAP+2MMa8Br3XZdqfH798P5PMPhI4RKKUiTdAHi4eao7OGtGtIKRUZNBF0Ue9OBEmx2iJQSkUGTQRd1LfYSY6NwmqRYIeilFKDQhNBF1qCWikVaTQRdKEF55RSkUYTQRfaIlBKRRpNBF3U2+x6MZlSKqJoIuhCWwRKqUijn3huxhg+LjpMTWOrJgKlVESJ+E88R7uTN7ZV8PD7RWwuqyM9MYaz80YGOyyllBo0EZkIquptbCmv44uyOl78vIzSwy2Mz0jkf742k0vnZRMXbQ12iEopNWgiJhGs3VHJs5+UsqX8CJX1rQBYBE4cl8bPz8vjrOlZWPQiMqVUBIqYRFDd0EpxTSOLJmYwa0wqs7NTyRudQkJMxPwXKKWUVxHzKXjl/LFcOT+wy1wqpVQo0umjSikV4TQRKKVUhNNEoJRSEU4TgVJKRThNBEopFeE0ESilVITTRKCUUhFOE4FSSkU4McYEO4Z+EZFqYB+QCtR57OrtdsfvGUCNH8Lo+lwDPbanfd62+3J+XX8f7PPt6zhfzsvbtqF4rn0d6+trO5C/Yxhar63+HXvfHszX1luM44wxmV6PNsaE5A/wsK+3O34HCgPx3AM9tqd93rb7cn5efh/U8+3rOF/OK1TO1V+v7UD+jofaa6t/x0Pvte3P37ExJqS7hv7Vj9td9/n7uQd6bE/7vG339fz8fa79ecy+jvPlvLxtG4rn2texvr62wfw77s9j6t9x3/uH0mvbr8cLua6h4yEihcaY/GDHMVgi6Xwj6Vwhss43ks4VgnO+odwiGIiHgx3AIIuk842kc4XIOt9IOlcIwvlGVItAKaVUd5HWIlBKKdWFJgKllIpwmgiUUirCaSJwE5FTReSvIvKoiKwPdjyBJCIWEfkfEXlARK4NdjyBJiJLROQD9+u7JNjxBJqIJIpIoYicH+xYAk1Eprtf19UicnOw4wkkEblYRB4RkedE5Gx/PnZYJAIReUxEqkRka5fty0Rkp4jsEZE7ensMY8wHxpibgH8DTwYy3uPhj3MFLgKyATtQFqhY/cFP52uARiCOIXy+fjpXgJ8AqwITpf/46X273f2+vQJYHMh4j4efzvUlY8x3gJuAK/0aXzjMGhKR03C90Z8yxsx0b7MCu4CzcL35C4DlgBW4r8tDXGeMqXLfbxWwwhjTMEjh94s/ztX9U2uMeUhEVhtjLhus+PvLT+dbY4xxikgW8HtjzNWDFX9/+OlcTwDScSW9GmPMvwcn+v7z1/tWRC4Ebgb+box5drDi7w8/f0b9DnjGGPOZv+ILi8XrjTHvi0hul80LgD3GmCIAEVkJXGSMuQ/w2mQWkbFA3VBNAuCfcxWRMqDNfbM9gOEeN3+9tm61QGxAAvUDP722S4BEIA9oEZHXjDHOQMY9UP56bY0xrwCviMirwJBMBH56bQX4FfC6P5MAhEki6MEYoNTjdhlwUh/3WQE8HrCIAqe/5/oC8ICInAq8H8jAAqRf5ysilwDnAMOAPwU0Mv/r17kaY34GICLfwt0SCmh0/tff13YJcAmuBP9aIAMLgP6+b/8DWAqkisgkY8xf/RVIOCeCfjPG/CLYMQwGY0wzrqQXEYwxL+BKfhHDGPNEsGMYDMaYd4F3gxzGoDDG3A/cH4jHDovB4h6UAzket7Pd28JRJJ0rRNb5RtK5QmSd75A513BOBAXAZBEZLyIxwFXAK0GOKVAi6Vwhss43ks4VIut8h8y5hkUiEJF/ABuAqSJSJiIrjDEO4BZgDbAdWGWM2RbMOP0hks4VIut8I+lcIbLOd6ifa1hMH1VKKTVwYdEiUEopNXCaCJRSKsJpIlBKqQiniUAppSKcJgKllIpwmgiUUirCaSJQYUFEGgf5+fyyZoW41kqoE5FNIrJDRP7Xh/tcLCJ5/nh+pUATgVJeiUivdbiMMYv8+HQfGGPmAHOB80Wkr7r6F+OqLqqUX2giUGFLRCaKyBsislFcK5RNc2+/QEQ+EZHPReRt9zoFiMhdIvJ3EfkI+Lv79mMi8q6IFInIrR6P3ej+d4l7/2r3N/pn3OWCEZGvurdtFJH7RaTXtQGMMS3AJlxVKRGR74hIgYh8ISLPi0iCiCwCLgR+625FTOzpPJXylSYCFc4eBv7DGHMi8P+AP7u3fwicbIyZC6wEfuxxnzxgqTFmufv2NFwlrBcAvxCRaC/PMxf4gfu+E4DFIhIHPASc637+zL6CFZE0YDJHS4O/YIyZb4w5AVcJghXGmPW46tHcboyZY4zZ28t5KuUTLUOtwpKIJAGLgH+6v6DD0UVpsoHnRGQUEAMUe9z1Ffc38w6vGmNagVYRqQKy6L7c5afGmDL3824CcnGtRlVkjOl47H8AN/QQ7qki8gWuJPBHY0yFe/tMEbkH1zoKSbhq0vTnPJXyiSYCFa4swBF333tXD+BasvIV98Imd3nsa+pybKvH7+14f8/4ckxvPjDGnC8i44GPRWSVMWYT8ARwsTHmC/dCM0u83Le381TKJ9o1pMKSMaYeKBaRy8G1zJ+InODencrRuu/XBiiEncAEj+UJ+1xs3N16+BWuxecBkoGD7u4oz3WWG9z7+jpPpXyiiUCFiwR3ed+Onx/i+vBc4e522QZc5D72LlxdKRuBmkAE4+5e+i7whvt5GoA6H+76V+A0dwL5L+AT4CNgh8cxK4Hb3YPdE+n5PJXyiZahVipARCTJGNPonkX0ILDbGPOHYMelVFfaIlAqcL7jHjzehqs76qHghqOUd9oiUEqpCKctAqWUinCaCJRSKsJpIlBKqQiniUAppSKcJgKllIpwmgiUUirC/X9hlaR7da/fFwAAAABJRU5ErkJggg==
"
>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It recommends a learning rate of around 1e-4, so we will use that.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lr</span> <span class="o">=</span> <span class="mf">1e-4</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's look at the documentation for <code>tune</code> function:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="AdaptiveTuner.tune" class="doc_header"><code>AdaptiveTuner.tune</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L371" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>AdaptiveTuner.tune</code>(<strong><code>epochs</code></strong>:<code>int</code>, <strong><code>lr</code></strong>:<code>float</code>=<em><code>None</code></em>, <strong><code>strategy</code></strong>:<code>Strategy</code>=<em><code>'fit_one_cycle'</code></em>, <strong><code>callbacks</code></strong>:<code>list</code>=<em><code>[]</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Fine tune <code>self.model</code> for <code>epochs</code> with an <code>lr</code> and <code>strategy</code></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>epochs</code></strong> : <em><code>&lt;class 'int'&gt;</code></em> <p>Number of iterations to train for</p></li>
</ul>
<ul>
<li><strong><code>lr</code></strong> : <em><code>&lt;class 'float'&gt;</code></em>, <em>optional</em>   <p>If None, finds a new learning rate and uses suggestion_method</p></li>
</ul>
<ul>
<li><strong><code>strategy</code></strong> : <em><code>&lt;class 'fastcore.basics.Strategy'&gt;</code></em>, <em>optional</em>  <p>A fitting method</p></li>
</ul>
<ul>
<li><strong><code>callbacks</code></strong> : <em><code>&lt;class 'list'&gt;</code></em>, <em>optional</em> <p>Extra fastai Callbacks</p></li>
</ul>
<ul>
<li><strong><code>kwargs</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can pass in a number of epochs, a learning rate, a strategy, and additional fastai callbacks to call.</p>
<p>Valid strategies live in the <code>Strategy</code> namespace class, and consist of:</p>
<ul>
<li>OneCycle (Also called the <a href="https://docs.fast.ai/callback.schedule.html#Learner.fit_one_cycle">One-Cycle Policy</a>)</li>
<li><a href="https://docs.fast.ai/callback.schedule.html#Learner.fit_flat_cos">CosineAnnealing</a></li>
<li><a href="https://docs.fast.ai/callback.schedule.html#Learner.fit_sgdr">SGDR</a></li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">adaptnlp</span> <span class="kn">import</span> <span class="n">Strategy</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this tutorial we will train with the One-Cycle policy, as currently it is one of the best schedulers to use.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's now <code>tune</code> with our strategy and our newly found learning rate for three iterations over the dataset</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tuner</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span>
    <span class="n">epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
    <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> 
    <span class="n">strategy</span><span class="o">=</span><span class="n">Strategy</span><span class="o">.</span><span class="n">OneCycle</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>accuracy</th>
      <th>f1_score</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.353429</td>
      <td>0.367736</td>
      <td>0.834720</td>
      <td>0.826503</td>
      <td>06:58</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.284561</td>
      <td>0.348747</td>
      <td>0.853640</td>
      <td>0.849727</td>
      <td>06:58</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.105604</td>
      <td>0.388459</td>
      <td>0.862440</td>
      <td>0.862621</td>
      <td>06:58</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Saving-Model">Saving Model<a class="anchor-link" href="#Saving-Model"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now that we have a trained model, let's save those weights away.</p>
<p>Calling <code>tuner.save</code> will save both the model and the tokenizer in the same format as how HuggingFace does:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="AdaptiveTuner.save" class="doc_header"><code>AdaptiveTuner.save</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/core.py#L393" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>AdaptiveTuner.save</code>(<strong><code>save_directory</code></strong>)</p>
</blockquote>
<p>Save a pretrained model to a <code>save_directory</code></p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>save_directory</code></strong> : <em><code>&lt;class 'inspect._empty'&gt;</code></em>  <p>A folder to save our model to</p></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tuner</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;good_model&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;good_model&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Performing-Inference">Performing Inference<a class="anchor-link" href="#Performing-Inference"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are two ways to get predictions, the first is with the <code>.predict</code> method in our <code>tuner</code>. This is great for if you just finished training and want to see how your model performs on some new data!
The other method is with AdaptNLP's inference API, which we will show afterwards</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="In-Tuner">In Tuner<a class="anchor-link" href="#In-Tuner"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First let's write a sentence ot test with</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sentence</span> <span class="o">=</span> <span class="s2">&quot;This movie was horrible! Hugh Jackman is a terrible actor&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And then predict with it:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="SequenceClassificationTuner.predict" class="doc_header"><code>SequenceClassificationTuner.predict</code><a href="https://github.com/novetta/adaptnlp/tree/master/adaptnlp/training/sequence_classification.py#L272" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>SequenceClassificationTuner.predict</code>(<strong><code>text</code></strong>:<code>Union</code>[<code>List</code>[<code>str</code>], <code>str</code>], <strong><code>bs</code></strong>:<code>int</code>=<em><code>64</code></em>, <strong><code>detail_level</code></strong>:<code>DetailLevel</code>=<em><code>'low'</code></em>, <strong><code>class_names</code></strong>:<code>list</code>=<em><code>None</code></em>)</p>
</blockquote>
<p>Predict some <code>text</code> for sequence classification with the currently loaded model</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong><code>text</code></strong> : <em><code>typing.Union[typing.List[str], str]</code></em> <p>Some text or list of texts to do inference with</p></li>
</ul>
<ul>
<li><strong><code>bs</code></strong> : <em><code>&lt;class 'int'&gt;</code></em>, <em>optional</em> <p>A batch size to use for multiple texts</p></li>
</ul>
<ul>
<li><strong><code>detail_level</code></strong> : <em><code>&lt;class 'fastcore.basics.DetailLevel'&gt;</code></em>, <em>optional</em>   <p>A detail level to return on the predictions</p></li>
</ul>
<ul>
<li><strong><code>class_names</code></strong> : <em><code>&lt;class 'list'&gt;</code></em>, <em>optional</em>   <p>A list of labels</p></li>
</ul>
<p><strong>Returns</strong>:</p>
<ul>
<li><em><code>&lt;class 'dict'&gt;</code></em>   <p>A dictionary of filtered predictions</p></li>
</ul>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tuner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;sentences&#39;: [&#39;This movie was horrible! Hugh Jackman is a terrible actor&#39;],
 &#39;predictions&#39;: [&#39;neg&#39;],
 &#39;probs&#39;: tensor([[9.9931e-01, 6.9142e-04]])}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="With-the-Inference-API">With the Inference API<a class="anchor-link" href="#With-the-Inference-API"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next we will use the <a href="/adaptnlp/sequence_classification.html#EasySequenceClassifier"><code>EasySequenceClassifier</code></a> class, which AdaptNLP offers:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">adaptnlp</span> <span class="kn">import</span> <span class="n">EasySequenceClassifier</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We simply construct the class:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">classifier</span> <span class="o">=</span> <span class="n">EasySequenceClassifier</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And call the <code>tag_text</code> method, passing in the sentence, the location of our saved model, and some names for our classes:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">classifier</span><span class="o">.</span><span class="n">tag_text</span><span class="p">(</span>
    <span class="n">sentence</span><span class="p">,</span>
    <span class="n">model_name_or_path</span><span class="o">=</span><span class="s1">&#39;good_model&#39;</span><span class="p">,</span>
    <span class="n">class_names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;negative&#39;</span><span class="p">,</span> <span class="s1">&#39;positive&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>2021-08-02 18:10:15,999 loading file good_model
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;sentences&#39;: [&#39;This movie was horrible! Hugh Jackman is a terrible actor&#39;],
 &#39;predictions&#39;: [&#39;negative&#39;],
 &#39;probs&#39;: tensor([[9.9931e-01, 6.9142e-04]])}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And we got the exact same output and probabilities!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There are also different levels of predictions we can return (which is also the same with our earlier <code>predict</code> call).</p>
<p>These live in a namespace <code>DetailLevel</code> class, with a few examples below:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">adaptnlp</span> <span class="kn">import</span> <span class="n">DetailLevel</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DetailLevel</span><span class="o">.</span><span class="n">Low</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;low&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>While some Easy modules will not return different items at each level, most will return only a few specific outputs at the Low level, and everything possible at the High level:</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">classifier</span><span class="o">.</span><span class="n">tag_text</span><span class="p">(</span>
    <span class="n">sentence</span><span class="p">,</span>
    <span class="n">model_name_or_path</span> <span class="o">=</span> <span class="s1">&#39;good_model&#39;</span><span class="p">,</span>
    <span class="n">detail_level</span><span class="o">=</span><span class="n">DetailLevel</span><span class="o">.</span><span class="n">Low</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;sentences&#39;: [&#39;This movie was horrible! Hugh Jackman is a terrible actor&#39;],
 &#39;predictions&#39;: [&#39;NEGATIVE&#39;],
 &#39;probs&#39;: tensor([[9.9931e-01, 6.9142e-04]])}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">classifier</span><span class="o">.</span><span class="n">tag_text</span><span class="p">(</span>
    <span class="n">sentence</span><span class="p">,</span>
    <span class="n">model_name_or_path</span> <span class="o">=</span> <span class="s1">&#39;good_model&#39;</span><span class="p">,</span>
    <span class="n">detail_level</span><span class="o">=</span><span class="n">DetailLevel</span><span class="o">.</span><span class="n">Medium</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;sentences&#39;: [&#39;This movie was horrible! Hugh Jackman is a terrible actor&#39;],
 &#39;predictions&#39;: [&#39;NEGATIVE&#39;],
 &#39;probs&#39;: tensor([[9.9931e-01, 6.9142e-04]]),
 &#39;pairings&#39;: OrderedDict([(&#39;This movie was horrible! Hugh Jackman is a terrible actor&#39;,
               tensor([9.9931e-01, 6.9142e-04]))]),
 &#39;classes&#39;: [&#39;NEGATIVE&#39;, &#39;POSITIVE&#39;]}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">classifier</span><span class="o">.</span><span class="n">tag_text</span><span class="p">(</span>
    <span class="n">sentence</span><span class="p">,</span>
    <span class="n">model_name_or_path</span> <span class="o">=</span> <span class="s1">&#39;good_model&#39;</span><span class="p">,</span>
    <span class="n">detail_level</span><span class="o">=</span><span class="n">DetailLevel</span><span class="o">.</span><span class="n">High</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;sentences&#39;: [Sentence: &#34;This movie was horrible ! Hugh Jackman is a terrible actor&#34;   [â Tokens: 11  â Sentence-Labels: {&#39;sc&#39;: [NEGATIVE (0.9993), POSITIVE (0.0007)]}]],
 &#39;predictions&#39;: [&#39;NEGATIVE&#39;],
 &#39;probs&#39;: tensor([[9.9931e-01, 6.9142e-04]]),
 &#39;pairings&#39;: OrderedDict([(&#39;This movie was horrible! Hugh Jackman is a terrible actor&#39;,
               tensor([9.9931e-01, 6.9142e-04]))]),
 &#39;classes&#39;: [&#39;NEGATIVE&#39;, &#39;POSITIVE&#39;]}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

